/* This file is part of closet which is released under GPL-3.0
GitHub: https://github.com/hgiesel/closet */

var e=[0,6,1],t=[],n=e.join(".")+(t.length>0?"-"+t.join("."):""),r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function u(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}var l,p=function(){function e(e,t){this.filters=e,this.options=t}return e.prototype.register=function(e,t,n){void 0===n&&(n={}),this.filters.register(e,t),this.options.set(e,n)},e.prototype.getOptions=function(e){return this.options.get(e,{})},e}(),f=function(){function e(e,t,n,r,o,i,u,s){this.preset=e,this.filters=t,this.options=n,this.registrar=new p(t,n),this.deferred=r,this.aftermath=o,this.cache=i,this.memory=u,this.environment=s}return e.prototype.getBaseInternals=function(e){return Object.assign({},{filters:this.filters,options:this.options,registrar:this.registrar,cache:this.cache,memory:this.memory,environment:this.environment,deferred:this.deferred,aftermath:this.aftermath,preset:this.preset},e)},e.prototype.getAftermathInternals=function(e,t){return Object.assign(this.getBaseInternals(e),t)},e.prototype.getDeferredInternals=function(e,t){return Object.assign(this.getBaseInternals(e),t)},e.prototype.getInternals=function(e,t,n){return Object.assign(this.getDeferredInternals(e,t),n)},e.prototype.filterAccessor=function(e,t){var n=this;return{getProcessor:function(r){return{execute:function(o,i){return n.filters.execute(r,o,n.getInternals(e,t,i))},getOptions:function(){return n.options.get(r,{})}}}}},e.prototype.executeDeferred=function(e,t){var n=this.getDeferredInternals(e,t);this.deferred.executeEach(n)},e.prototype.executeAftermath=function(e,t){var n=this.getAftermathInternals(e,t);this.aftermath.executeEach(n)},e.prototype.switchPreset=function(e){this.preset=e},e.prototype.clear=function(){this.memory.clear(),this.aftermath.clear()},e.prototype.reset=function(){this.cache.clear(),this.deferred.clear()},e.prototype.install=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var o=s(n),i=o.next();!i.done;i=o.next()){var u=i.value;u(this.registrar)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e}(),h=function(e,t){return{ready:t,result:e,parse:!1}},d=function(e,t){return n=e.toReprString(),r=t.ready,h(n,r);var n,r},m={ready:!1,result:[],parse:!1},v=function(e){var t,n,r;switch(typeof e){case"string":return h(e,!0);case"object":return{ready:null===(t=e.ready)||void 0===t||t,result:null!==(n=e.result)&&void 0!==n?n:[],parse:null!==(r=e.parse)&&void 0!==r&&r};default:return m}},y=function(){function e(){this.filters=new Map}return e.prototype.register=function(e,t){this.filters.set(e,t)},e.prototype.has=function(e){return this.filters.has(e)},e.prototype.get=function(e){var t;return null!==(t=this.filters.get(e))&&void 0!==t?t:null},e.prototype.getOrDefault=function(e){var t;return null!==(t=this.get(e))&&void 0!==t?t:d},e.prototype.unregisterFilter=function(e){this.filters.delete(e)},e.prototype.clearFilters=function(){this.filters.clear()},e.prototype.execute=function(e,t,n){var r=this.getOrDefault(e);return v(r(t,n))},e}(),g=function(){function e(e){this.storage=e}return e.prototype.set=function(e,t){this.storage.set(e,t)},e.prototype.get=function(e,t){var n;return null!==(n=this.storage.get(e))&&void 0!==n?n:t},e.prototype.has=function(e){return this.storage.has(e)},e.prototype.fold=function(e,t,n){var r=t(this.get(e,n));return this.set(e,r),r},e.prototype.post=function(e,t,n){var r=this.get(e,n);return this.set(e,t(r)),r},e.prototype.lazy=function(e,t){var n;return null!==(n=this.get(e,null))&&void 0!==n?n:this.fold(e,t,null)},e.prototype.over=function(e,t,n){var r=this.get(e,n);return this.set(e,r),t(r)},e.prototype.delete=function(e){this.storage.delete(e)},e.prototype.clear=function(){this.storage.clear()},e}(),b=function(e){return(e+1>>>1)-1},x=function(e){return 1+(e<<1)},A=function(e){return e+1<<1},w=function(){function e(e){this._heap=[],this._comparator=e}return e.prototype.greater=function(e,t){return this._comparator(this._heap[e],this._heap[t])},e.prototype.swap=function(e,t){var n;n=a([this._heap[t],this._heap[e]],2),this._heap[e]=n[0],this._heap[t]=n[1]},e.prototype.siftUp=function(){for(var e=this.size()-1;e>0&&this.greater(e,b(e));)this.swap(e,b(e)),e=b(e)},e.prototype.siftDown=function(){for(var e=0;x(e)<this.size()&&this.greater(x(e),e)||A(e)<this.size()&&this.greater(A(e),e);){var t=A(e)<this.size()&&this.greater(A(e),x(e))?A(e):x(e);this.swap(e,t),e=t}},e.prototype.size=function(){return this._heap.length},e.prototype.isEmpty=function(){return 0===this.size()},e.prototype.peek=function(){return this._heap[0]},e.prototype.push=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach((function(t){e._heap.push(t),e.siftUp()})),this.size()},e.prototype.pop=function(){var e=this.peek(),t=this.size()-1;return t>0&&this.swap(0,t),this._heap.pop(),this.siftDown(),e},e.prototype.generate=function(){var e;return u(this,(function(t){switch(t.label){case 0:e=this.pop(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.pop(),[3,1];case 3:return[2,null]}}))},e}(),k={priority:0,persistent:!1},E=function(e,t){return e.priority>t.priority},F=function(){function e(){this._deferred=new Map,this._blocked=new Set}return e.prototype.register=function(e,t,n){var r,o;void 0===n&&(n=k),this._deferred.set(e,{keyword:e,procedure:t,priority:null!==(r=n.priority)&&void 0!==r?r:k.priority,persistent:null!==(o=n.persistent)&&void 0!==o?o:k.persistent})},e.prototype.registerIfNotExists=function(e,t,n){void 0===n&&(n=k),this.isRegistered(e)||this.register(e,t,n)},e.prototype.unregister=function(e){this._deferred.delete(e)},e.prototype.isRegistered=function(e){return this._deferred.has(e)},e.prototype.block=function(e){this._blocked.add(e)},e.prototype.unblock=function(e){this._blocked.delete(e)},e.prototype.isBlocked=function(e){return this._blocked.has(e)},e.prototype.clear=function(){this._deferred.clear(),this._blocked.clear()},e.prototype.executeEach=function(e){var t,n,r=new w(E);r.push.apply(r,c(this._deferred.values()));try{for(var o=s(r.generate()),i=o.next();!i.done;i=o.next()){var u=i.value;this.isBlocked(u.keyword)||u.procedure(u,e),u.persistent||this.unregister(u.keyword)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._blocked.clear()},e}();!function(e){e[e.Ready=0]="Ready",e[e.NotReady=1]="NotReady",e[e.ContinueTags=2]="ContinueTags",e[e.ContainsTags=3]="ContainsTags"}(l||(l={}));var S,C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.make=function(e,n){void 0===e&&(e={}),void 0===n&&(n=new Map);var r=Object.prototype.hasOwnProperty.call(globalThis,"_closetEnvironment")?globalThis._closetEnvironment:globalThis._closetEnvironment=new Map;return new t(e,new y,new g(new Map),new F,new F,new g(new Map),new g(n),new g(r))},t.prototype.makeAccessor=function(t,n){var r=this,o=this.filterAccessor(t,n);return function(i){var u=o.getProcessor(i);return{execute:function(o,i){return{status:(s=u.execute(o,e.prototype.getInternals.call(r,t,n,i))).parse?s.ready?l.ContinueTags:l.ContainsTags:s.ready?l.Ready:l.NotReady,result:s.result};var s},getOptions:function(){return e=u.getOptions(),i=null!==(t=e.optics)&&void 0!==t?t:[],{inlineOptics:null!==(n=e.inlineOptics)&&void 0!==n?n:i,blockOptics:null!==(r=e.blockOptics)&&void 0!==r?r:i,capture:null!==(o=e.capture)&&void 0!==o&&o};var e,t,n,r,o,i}}}},t.prototype.finishIteration=function(e,t){this.executeDeferred(e,t)},t.prototype.finishRun=function(e,t){this.executeAftermath(e,t),this.reset()},t}(f),B=function(e){return e},N=function(e,t){return t},D=function(e){return function(t){return e}},O=function(e,t){var n,r,o,i,u=[];try{for(var a=s(t),c=a.next();!c.done;c=a.next()){var l=e[d=c.value];l&&u.push(l)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}if(t.length<e.length){var p=Array.from(new Array(e.length-t.length),(function(e,n){return n+t.length}));try{for(var f=s(p),h=f.next();!h.done;h=f.next()){var d=h.value;u.push(e[d])}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}}return u},_=function(e,t,n){return e.reverse().reduce((function(e,n){return n(t,e)}),n)};!function(e){e[e.Strong=0]="Strong",e[e.Choice=1]="Choice",e[e.Traversing=2]="Traversing",e[e.Bicontravariant=3]="Bicontravariant"}(S||(S={}));var $={classes:[S.Choice,S.Strong,S.Traversing],dimap:function(e,t,n){return function(r){return t(n(e(r)))}},first:function(e){return function(t){var n=a(t,2),r=n[0],o=n[1];return[e(r),o]}},right:function(e){return function(t){var n=a(t,2),r=n[0],o=n[1];return r?[r,e(o)]:[r,o]}}},T={classes:[S.Bicontravariant,S.Choice,S.Strong,S.Traversing],dimap:function(e,t,n){return function(e,t){return function(n){return t(e(n))}}(e,n)},first:function(e){return function(t){var n=a(t,1)[0];return e(n)}},right:function(e){return function(t){var n=a(t,2),r=n[0],o=n[1];return r?e(o):[]}}},I=function(e){var t=function(e){var t,n,r,o;return"string"==typeof e?{sep:e,max:1/0,trim:!1,keepEmpty:!0}:{sep:null!==(t=e.sep)&&void 0!==t?t:"::",max:null!==(n=e.max)&&void 0!==n?n:1/0,trim:null!==(r=e.trim)&&void 0!==r&&r,keepEmpty:null===(o=e.keepEmpty)||void 0===o||o}}(e),n=t.sep,r=t.max,o=t.trim,i=t.keepEmpty,u=function(e){for(var t=[],u=e,s=!1;!s;){var c=u.indexOf(n),l=a(c<0||t.length+1===r?[u,"",!0]:[u.slice(0,c),u.slice(c+n.length),!1],3),p=l[0],f=l[1],h=l[2],d=o?p.trim():p;(i||d.length>=1)&&t.push(d),u=f,s=h}return[t]},s=function(e){return a(e,1)[0]};return function(e,t){var n=e.first(t);return e.dimap(u,s,n)}},j=function(e){var t,n;return"string"==typeof e?{before:e,after:e}:{before:null!==(t=e.before)&&void 0!==t?t:"",after:null!==(n=e.after)&&void 0!==n?n:""}},P=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},z=function(e){return e instanceof RegExp?e.source:e},M=function(e){var t=j(e),n=t.before,r=t.after,o=function(e){var t=new RegExp("("+n+")(.*?)("+r+")","gsu"),o=[],i=[],u=0;e.replace(t,(function(t,n,r,s,a){var c=e.substring(u,a+n.length);return o.push(c),i.push(r),u=a+t.length-s.length,""})),o.push(e.substring(u));var s,a,l=c(Array(i.length).keys()),p=(s=o,a=l,function(e){var t=e[e.length-1]||{},n=[s[0]];return a.forEach((function(r,o){var i=Number.isInteger(r)?e[r]:t[r];n.push(i,s[o+1])})),n.join("")});return[i,p]},i=function(e){var t=a(e,2),n=t[0];return(0,t[1])(n)};return function(e,t){var n=e.first(t);return e.dimap(o,i,n)}},L=function(e){var t=j(e),n=t.before,r=t.after,o=function(e){var t=new RegExp("^"+z(n)+"(.*?)"+z(r)+"$","su"),o=e;return e.replace(t,(function(e,t){return o=t,""})),[o,null]},i=function(e){return a(e,1)[0]};return function(e,t){var n=e.first(t);return e.dimap(o,i,n)}},G=function(){return function(e,t){return n=t,function(e){return e.map(n)};var n}},R=Object.freeze({__proto__:null,run:_,dictFunction:$,dictForget:T,separated:I,templated:function(e){var t=e.before,n=e.after;return M({before:P(t),after:P(n)})},templatedRegex:M,stripped:function(e){var t=e.before,n=e.after;return L({before:"^"+P(t),after:P(n)+"$"})},strippedRegex:L,mapped:G}),q=function(e,t){return e&&t.isReady()},H=function(e){return e.map((function(e){return e.toString()})).join("")},J=function(e){return e.map((function(e){return e.toReprString()})).join("")},K=/^(?:<br(?: ?\/)?>|\n)|(?:<br(?: ?\/)?>|\n)$/gu,Y=function(){function e(e,t,n,r,o,i,u,s,a,c){this._inlineOptics=[],this._inlineGetter=B,this._blockOptics=[],this._blockGetter=B,this.fullKey=e,this.key=t,this.num=n,this.fullOccur=r,this.occur=o,this.delimiters=i,this._inlineNodes=u,this.hasInline=s,this._blockNodes=a,this.hasBlock=c}return Object.defineProperty(e.prototype,"inlineNodes",{get:function(){return this._inlineNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockNodes",{get:function(){return this._blockNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerNodes",{get:function(){return this.hasBlock?this.blockNodes:this.inlineNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalNodes",{set:function(e){this.hasBlock?this._blockNodes=e:this._inlineNodes=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inlineText",{get:function(){return H(this.inlineNodes)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockText",{get:function(){return function(e){return e.replace(K,"")}(H(this.blockNodes))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.hasBlock?this.blockText:this.inlineText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inlineOptics",{get:function(){return this._inlineOptics},set:function(e){this._inlineOptics=e,this._inlineGetter=_(e,T,B)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockOptics",{get:function(){return this._blockOptics},set:function(e){this._blockOptics=e,this._blockGetter=_(e,T,B)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optics",{get:function(){return this.hasBlock?this.blockOptics:this.inlineOptics},set:function(e){this.hasBlock?this.blockOptics=e:this.inlineOptics=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inlineGetter",{get:function(){return this._inlineGetter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockGetter",{get:function(){return this._blockGetter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getter",{get:function(){return this.hasBlock?this.blockGetter:this.inlineGetter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inlineValues",{get:function(){return this.inlineGetter(this.inlineText)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blockValues",{get:function(){return this.blockGetter(this.blockText)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){return this.hasBlock?this.blockValues:this.inlineValues},enumerable:!1,configurable:!0}),e.prototype.inlineTraverse=function(e){return _(this.inlineOptics,$,e)(this.inlineText)},e.prototype.blockTraverse=function(e){return _(this.blockOptics,$,e)(this.blockText)},e.prototype.traverse=function(e){return this.hasBlock?this.blockTraverse(e):this.inlineTraverse(e)},e.prototype.wrapWithDelimiters=function(e,t){return""+this.delimiters.open+e+this.fullKey+(t?this.delimiters.sep+t:"")+this.delimiters.close},e.prototype.wrapBlock=function(e,t){return""+this.wrapWithDelimiters("#",t)+e+this.wrapWithDelimiters("/")},e.prototype.baseToString=function(e,t){return this.hasInline?this.hasBlock?this.wrapBlock(t(),e()):this.wrapWithDelimiters("",e()):this.hasBlock?this.wrapBlock(t()):this.wrapWithDelimiters("")},e.prototype.toString=function(){var e=this;return this.baseToString((function(){return e.inlineText}),(function(){return e.blockText}))},e.prototype.toReprString=function(){var e=this;return this.baseToString((function(){return J(e.inlineNodes)}),(function(){return J(e.blockNodes)}))},e.prototype.isReady=function(){return!1},e.prototype.evaluate=function(e,t,n,r){var o;void 0===r&&(r=!1);var i=t(this.key),u=n.length-1,s=i.getOptions().capture,a=function(r,o){return r.evaluate(e,t,c(n,[o]))},p=s&&!r;!s&&!r&&(o=this.innerNodes).splice.apply(o,c([0,this.innerNodes.length],this.innerNodes.flatMap(a)));var f=this.innerNodes.reduce(q,!0);this.inlineOptics=i.getOptions().inlineOptics,this.blockOptics=i.getOptions().blockOptics;var h,d={path:n,depth:u,ready:f,isCapture:p},m=i.execute(this,d);switch(m.status){case l.Ready:h="string"==typeof m.result?[new X(m.result)]:m.result;break;case l.NotReady:h=p?this.innerNodes:[this];break;case l.ContinueTags:h=e.rawParse(m.result).flatMap(a);break;case l.ContainsTags:h=e.rawParse(m.result)}return p?(this.internalNodes=h,this.evaluate(e,t,n,!0)):h},e}(),W=function(){function e(){}return e.prototype.isReady=function(){return!0},e.prototype.evaluate=function(){return[this]},e.prototype.toReprString=function(){var e;return null!==(e=this.toString())&&void 0!==e?e:""},e}(),X=function(e){function t(t){var n=e.call(this)||this;return n.text=t,n}return o(t,e),t.prototype.toString=function(){return this.text},t}(W),U=function(e){function t(t){var n=e.call(this)||this;return n.escaped=t,n}return o(t,e),t.prototype.toString=function(){return 1===this.escaped.length?this.escaped:this.escaped.slice(1)},t.prototype.toReprString=function(){return this.escaped},t}(W),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.toString=function(){return null},t}(W),Q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Z(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var ee=Z((function(e){var t,n;t=Q,n=function(){function e(t,n,r){return this.id=++e.highestId,this.name=t,this.symbols=n,this.postprocess=r,this}function t(e,t,n,r){this.rule=e,this.dot=t,this.reference=n,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function n(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,t){this.rules=e,this.start=t||this.rules[0].name;var n=this.byName={};this.rules.forEach((function(e){n.hasOwnProperty(e.name)||(n[e.name]=[]),n[e.name].push(e)}))}function o(){this.reset("")}function i(e,t,i){if(e instanceof r){var u=e;i=t}else u=r.fromCompiled(e,t);for(var s in this.grammar=u,this.options={keepHistory:!1,lexer:u.lexer||new o},i||{})this.options[s]=i[s];this.lexer=this.options.lexer,this.lexerState=void 0;var a=new n(u,0);this.table=[a],a.wants[u.start]=[],a.predict(u.start),a.process(),this.current=0}function u(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(u).join(" "):this.symbols.slice(0,e).map(u).join(" ")+" ● "+this.symbols.slice(e).map(u).join(" ");return this.name+" → "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var n=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=e,n.isComplete&&(n.data=n.build(),n.right=void 0),n},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,i.fail))},n.prototype.process=function(e){for(var t=this.states,n=this.wants,r=this.completed,o=0;o<t.length;o++){var u=t[o];if(u.isComplete){if(u.finish(),u.data!==i.fail){for(var s=u.wantedBy,a=s.length;a--;){var c=s[a];this.complete(c,u)}if(u.reference===this.index){var l=u.rule.name;(this.completed[l]=this.completed[l]||[]).push(u)}}}else{if("string"!=typeof(l=u.rule.symbols[u.dot])){this.scannable.push(u);continue}if(n[l]){if(n[l].push(u),r.hasOwnProperty(l)){var p=r[l];for(a=0;a<p.length;a++){var f=p[a];this.complete(u,f)}}}else n[l]=[u],this.predict(l)}}},n.prototype.predict=function(e){for(var n=this.grammar.byName[e]||[],r=0;r<n.length;r++){var o=n[r],i=this.wants[e],u=new t(o,0,this.index,i);this.states.push(u)}},n.prototype.complete=function(e,t){var n=e.nextState(t);this.states.push(n)},r.fromCompiled=function(t,n){var o=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var i=new r(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),n);return i.lexer=o,i},o.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(e,t){var n=this.buffer;if("string"==typeof n){var r=n.split("\n").slice(Math.max(0,this.line-5),this.line);n.indexOf("\n",this.index);var o=this.index-this.lastLineBreak,i=String(this.line).length;return t+=" at line "+this.line+" col "+o+":\n\n",t+=r.map((function(e,t){return u(this.line-r.length+t+1,i)+" "+e}),this).join("\n"),t+="\n"+u("",i+o)+"^\n"}return t+" at index "+(this.index-1);function u(e,t){var n=String(e);return Array(t-n.length+1).join(" ")+n}},i.fail={},i.prototype.feed=function(e){var t,r=this.lexer;for(r.reset(e,this.lexerState);;){try{if(!(t=r.next()))break}catch(e){var i=new n(this.grammar,this.current+1);throw this.table.push(i),(a=new Error(this.reportLexerError(e))).offset=this.current,a.token=e.token,a}var u=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var s=this.current+1;i=new n(this.grammar,s),this.table.push(i);for(var a,c=void 0!==t.text?t.text:t.value,l=r.constructor===o?t.value:t,p=u.scannable,f=p.length;f--;){var h=p[f],d=h.rule.symbols[h.dot];if(d.test?d.test(l):d.type?d.type===t.type:d.literal===c){var m=h.nextState({data:l,token:t,isToken:!0,reference:s-1});i.states.push(m)}}if(i.process(),0===i.states.length)throw(a=new Error(this.reportError(t))).offset=this.current,a.token=t,a;this.options.keepHistory&&(u.lexerState=r.save()),this.current++}return u&&(this.lexerState=r.save()),this.results=this.finish(),this},i.prototype.reportLexerError=function(e){var t,n,r=e.token;return r?(t="input "+JSON.stringify(r.text[0])+" (lexer error)",n=this.lexer.formatError(r,"Syntax error")):(t="input (lexer error)",n=e.message),this.reportErrorCommon(n,t)},i.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),n=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(n,t)},i.prototype.reportErrorCommon=function(e,t){var n=[];n.push(e);var r=this.table.length-2,o=this.table[r],i=o.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===i.length?(n.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(o.states,n)):(n.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),i.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],r=t.rule.symbols[t.dot],o=this.getSymbolDisplay(r);n.push("A "+o+" based on:"),this.displayStateStack(e,n)}),this)),n.push(""),n.join("\n")},i.prototype.displayStateStack=function(e,t){for(var n,r=0,o=0;o<e.length;o++){var i=e[o],u=i.rule.toString(i.dot);u===n?r++:(r>0&&t.push("    ^ "+r+" more lines identical to this"),r=0,t.push("    "+u)),n=u}},i.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},i.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var n=e.wantedBy[0],r=[e].concat(t),o=this.buildFirstStateStack(n,r);return null===o?null:[e].concat(o)},i.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},i.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},i.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},i.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(n){n.rule.name===t&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==i.fail&&e.push(n)})),e.map((function(e){return e.data}))},{Parser:i,Grammar:r,Rule:e}},e.exports?e.exports=n():t.nearley=n()})),te=/^((?:[a-zA-Z_/]|%\w)+)(\d*)(?::(\d+))?$/u,ne=function(e,t){var n,r=(null!==(n=e.get(t))&&void 0!==n?n:-1)+1;return e.set(t,r),r},re=new(function(){function e(){this.tagCounter=null,this.tagCounterFull=null,this.delimiters=null}return e.prototype.increment=function(e,t){return[ne(this.tagCounterFull,e),ne(this.tagCounter,t)]},e.prototype.build=function(e,t,n,r,o){void 0===r&&(r=[]),void 0===o&&(o=!1);var i=e.match(te);if(!i)throw new Error("Could not match key. This should never happen.");var u=i[1],s=i[2].length>0?Number(i[2]):null,c=a(this.increment(e,u),2),l=c[0],p=c[1];return new Y(e,u,s,l,p,this.delimiters,t,n,r,o)},e.prototype.push=function(e,t){this.tagCounterFull=e[0],this.tagCounter=e[1],this.delimiters=t},e}());function oe(e){return e[0]}var ie=function(e){return{Lexer:e,ParserRules:[{name:"start",symbols:["content"],postprocess:oe},{name:"content$ebnf$1",symbols:[]},{name:"content$ebnf$1",symbols:["content$ebnf$1","node"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"content",symbols:["content$ebnf$1"],postprocess:oe},{name:"node",symbols:["text"],postprocess:oe},{name:"node",symbols:["inlinetag"],postprocess:oe},{name:"node",symbols:["blocktag"],postprocess:oe},{name:"text",symbols:[e.has("text")?{type:"text"}:text],postprocess:function(e){var t=a(e,1)[0];return new X(t.value)}},{name:"text",symbols:[e.has("escapeseq")?{type:"escapeseq"}:escapeseq],postprocess:function(e){var t=a(e,1)[0];return new U(t.value)}},{name:"inlinetag",symbols:[e.has("inlineopen")?{type:"inlineopen"}:inlineopen,"inline"],postprocess:function(e){var t=a(e,2),n=a(t[1],3),r=n[0],o=n[1],i=n[2];return re.build(r.value,o,i)}},{name:"blocktag",symbols:[e.has("blockopen")?{type:"blockopen"}:blockopen,"inline","content","blockclose"],postprocess:function(e,t,n){var r=a(e,4),o=a(r[1],3),i=o[0],u=o[1],s=o[2],c=r[2],l=r[3];return l&&i.value!==l.value?n:re.build(i.value,u,s,c,!0)}},{name:"inline$ebnf$1$subexpression$1",symbols:[e.has("sep")?{type:"sep"}:sep,"content"]},{name:"inline$ebnf$1",symbols:["inline$ebnf$1$subexpression$1"],postprocess:oe},{name:"inline$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"inline",symbols:[e.has("keyname")?{type:"keyname"}:keyname,"inline$ebnf$1",e.has("close")?{type:"close"}:close],postprocess:function(e){var t=a(e,2),n=t[0],r=t[1];return r?[n,r[1],!0]:[n,[],!1]}},{name:"blockclose$ebnf$1",symbols:[e.has("keyname")?{type:"keyname"}:keyname],postprocess:oe},{name:"blockclose$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"blockclose",symbols:[e.has("blockclose")?{type:"blockclose"}:blockclose,"blockclose$ebnf$1",e.has("close")?{type:"close"}:close],postprocess:function(e){return a(e,2)[1]}}],ParserStart:"start"}},ue={open:"[[",sep:"::",close:"]]"};var se,ae=Z((function(e){var t,n;t=Q,n=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n="boolean"==typeof(new RegExp).sticky;function r(e){return e&&"[object RegExp]"===t.call(e)}function o(e){return e&&"object"==typeof e&&!r(e)&&!Array.isArray(e)}function i(e){return"("+e+")"}function u(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function s(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(r(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function a(t,n){if(o(n)||(n={match:n}),n.include)throw new Error("Matching rules cannot also include states");var i={defaultType:t,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var u in n)e.call(n,u)&&(i[u]=n[u]);if("string"==typeof i.type&&t!==i.type)throw new Error("Type transform cannot be a string (type '"+i.type+"' for token '"+t+"')");var s=i.match;return i.match=Array.isArray(s)?s:s?[s]:[],i.match.sort((function(e,t){return r(e)&&r(t)?0:r(t)?-1:r(e)?1:t.length-e.length})),i}function c(e){return Array.isArray(e)?function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.include)for(var o=[].concat(r.include),i=0;i<o.length;i++)t.push({include:o[i]});else{if(!r.type)throw new Error("Rule has no type: "+JSON.stringify(r));t.push(a(r.type,r))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),n=[],r=0;r<t.length;r++){var i=t[r],u=e[i],s=[].concat(u);if("include"!==i){var c=[];s.forEach((function(e){o(e)?(c.length&&n.push(a(i,c)),n.push(a(i,e)),c=[]):c.push(e)})),c.length&&n.push(a(i,c))}else for(var l=0;l<s.length;l++)n.push({include:s[l]})}return n}(e)}var l=a("error",{lineBreaks:!0,shouldThrow:!0});function p(e,t){for(var o=null,a=Object.create(null),c=!0,p=null,f=[],h=[],d=0;d<e.length;d++)e[d].fallback&&(c=!1);for(d=0;d<e.length;d++){var m=e[d];if(m.include)throw new Error("Inheritance is not allowed in stateless lexers");if(m.error||m.fallback){if(o)throw!m.fallback==!o.fallback?new Error("Multiple "+(m.fallback?"fallback":"error")+" rules not allowed (for token '"+m.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+m.defaultType+"')");o=m}var v=m.match.slice();if(c)for(;v.length&&"string"==typeof v[0]&&1===v[0].length;)a[v.shift().charCodeAt(0)]=m;if(m.pop||m.push||m.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+m.defaultType+"')");if(m.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+m.defaultType+"')")}if(0!==v.length){c=!1,f.push(m);for(var y=0;y<v.length;y++){var g=v[y];if(r(g))if(null===p)p=g.unicode;else if(p!==g.unicode&&!1===m.fallback)throw new Error("If one rule is /u then all must be")}var b=u(v.map(s)),x=new RegExp(b);if(x.test(""))throw new Error("RegExp matches empty string: "+x);if(new RegExp("|"+b).exec("").length-1>0)throw new Error("RegExp has capture groups: "+x+"\nUse (?: … ) instead");if(!m.lineBreaks&&x.test("\n"))throw new Error("Rule should declare lineBreaks: "+x);h.push(i(b))}}var A=o&&o.fallback,w=n&&!A?"ym":"gm",k=n||A?"":"|";return!0===p&&(w+="u"),{regexp:new RegExp(u(h)+k,w),groups:f,fast:a,error:o||l}}function f(e,t,n){var r=e&&(e.push||e.next);if(r&&!n[r])throw new Error("Missing state '"+r+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var h=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};h.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},h.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},h.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},h.prototype.popState=function(){this.setState(this.stack.pop())},h.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var d=n?function(e,t){return e.exec(t)}:function(e,t){var n=e.exec(t);return 0===n[0].length?null:n};function m(){return this.value}if(h.prototype._getGroup=function(e){for(var t=this.groups.length,n=0;n<t;n++)if(void 0!==e[n+1])return this.groups[n];throw new Error("Cannot find token type for matched text")},h.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var n=this.buffer;if(e!==n.length){if(u=this.fast[n.charCodeAt(e)])return this._token(u,n.charAt(e),e);var r=this.re;r.lastIndex=e;var o=d(r,n),i=this.error;if(null==o)return this._token(i,n.slice(e,n.length),e);var u=this._getGroup(o),s=o[0];return i.fallback&&o.index!==e?(this.queuedGroup=u,this.queuedText=s,this._token(i,n.slice(e,o.index),e)):this._token(u,s,e)}},h.prototype._token=function(e,t,n){var r=0;if(e.lineBreaks){var o=/\n/g,i=1;if("\n"===t)r=1;else for(;o.exec(t);)r++,i=o.lastIndex}var u={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:m,offset:n,lineBreaks:r,line:this.line,col:this.col},s=t.length;if(this.index+=s,this.line+=r,0!==r?this.col=s-i+1:this.col+=s,e.shouldThrow)throw new Error(this.formatError(u,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),u},"undefined"!=typeof Symbol&&Symbol.iterator){var v=function(e){this.lexer=e};v.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},v.prototype[Symbol.iterator]=function(){return this},h.prototype[Symbol.iterator]=function(){return new v(this)}}return h.prototype.formatError=function(e,t){if(null==e){var n=this.buffer.slice(this.index);e={text:n,offset:this.index,lineBreaks:-1===n.indexOf("\n")?0:1,line:this.line,col:this.col}}var r=Math.max(0,e.offset-e.col+1),o=e.lineBreaks?e.text.indexOf("\n"):e.text.length,i=this.buffer.substring(r,e.offset+o);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},h.prototype.clone=function(){return new h(this.states,this.state)},h.prototype.has=function(e){return!0},{compile:function(e){var t=p(c(e));return new h({start:t},"start")},states:function(e,t){var n=e.$all?c(e.$all):[];delete e.$all;var r=Object.getOwnPropertyNames(e);t||(t=r[0]);for(var o=Object.create(null),i=0;i<r.length;i++)o[b=r[i]]=c(e[b]).concat(n);for(i=0;i<r.length;i++)for(var u=o[b=r[i]],s=Object.create(null),a=0;a<u.length;a++){var l=u[a];if(l.include){var d=[a,1];if(l.include!==b&&!s[l.include]){s[l.include]=!0;var m=o[l.include];if(!m)throw new Error("Cannot include nonexistent state '"+l.include+"' (in state '"+b+"')");for(var v=0;v<m.length;v++){var y=m[v];-1===u.indexOf(y)&&d.push(y)}}u.splice.apply(u,d),a--}}var g=Object.create(null);for(i=0;i<r.length;i++){var b;g[b=r[i]]=p(o[b],!0)}for(i=0;i<r.length;i++){var x=r[i],A=g[x],w=A.groups;for(a=0;a<w.length;a++)f(w[a],x,g);var k=Object.getOwnPropertyNames(A.fast);for(a=0;a<k.length;a++)f(A.fast[k[a]],x,g)}return new h(g,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),n=Object.create(null),r=Object.getOwnPropertyNames(e),o=0;o<r.length;o++){var i=r[o],u=e[i];(Array.isArray(u)?u:[u]).forEach((function(e){if((n[e.length]=n[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+i+"')");t[e]=i}))}function s(e){return JSON.stringify(e)}var a="";for(var c in a+="switch (value.length) {\n",n){var l=n[c];a+="case "+c+":\n",a+="switch (value) {\n",l.forEach((function(e){var n=t[e];a+="case "+s(e)+": return "+s(n)+"\n"})),a+="}\n"}return a+="}\n",Function("value",a)}}},e.exports?e.exports=n():t.moo=n()})),ce=/(?:[a-zA-Z_]|%\w)+\d*/u,le=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},pe=function(e){var t=le(e.open),n=le(e.close),r=new RegExp("[\\s\\S]+?(?=\\\\|"+t+"|$)","u"),o=new RegExp("[\\s\\S]+?(?=\\\\|"+t+"|"+n+")","u"),i=new RegExp("\\\\(?:"+t+"|"+n+")?","u"),u={match:e.open,push:"inlinekey"},s={match:e.open+"#",push:"blockkey"},a={match:e.open+"/",push:"blockclose"},c={match:e.close,pop:1},l={match:e.close,next:"blockmain"},p={match:ce},f={match:r,lineBreaks:!0},h={match:o,lineBreaks:!0},d={match:i},m=function(t){return{match:e.sep,next:t}};return ae.states({main:{blockopen:s,inlineopen:u,escapeseq:d,text:f},blockkey:{keyname:p,sep:m("blocktag"),close:l},inlinekey:{keyname:p,sep:m("inlinetag"),close:c},blocktag:{blockopen:s,inlineopen:u,escapeseq:d,close:l,text:h},inlinetag:{blockopen:s,inlineopen:u,escapeseq:d,close:c,text:h},blockmain:{blockopen:s,blockclose:a,inlineopen:u,escapeseq:d,text:f},blockclose:{keyname:p,close:c}})},fe=function(e,t){var n=function(e,t){var n=new ee.Parser(t);try{return n.feed(e).results}catch(t){return console.log("Will default to Trivial Base Tag, due to error parsing text:",t),[[new X(e)]]}}(e,t);return n.length>1&&console.log("Ambiguous template grammar"),n[0]},he=function(e,t){return c(function(e,t){var n,r,o,i,a,c,l,p,f,h,d,m;return u(this,(function(u){switch(u.label){case 0:n=!0,u.label=1;case 1:u.trys.push([1,14,15,16]),r=s(e),o=r.next(),u.label=2;case 2:return o.done?[3,13]:(i=o.value,n?(n=!1,[3,5]):[3,3]);case 3:return[4,t];case 4:u.sent(),u.label=5;case 5:u.trys.push([5,10,11,12]),d=void 0,a=s(i),c=a.next(),u.label=6;case 6:return c.done?[3,9]:[4,c.value];case 7:u.sent(),u.label=8;case 8:return c=a.next(),[3,6];case 9:return[3,12];case 10:return l=u.sent(),d={error:l},[3,12];case 11:try{c&&!c.done&&(m=a.return)&&m.call(a)}finally{if(d)throw d.error}return[7];case 12:return o=r.next(),[3,2];case 13:return[3,16];case 14:return p=u.sent(),f={error:p},[3,16];case 15:try{o&&!o.done&&(h=r.return)&&h.call(r)}finally{if(f)throw f.error}return[7];case 16:return[2]}}))}(e.map((function(e){return fe(e,t)})),new V))};!function(e){e[e.Single=1]="Single",e[e.Fragments=2]="Fragments"}(se||(se={}));var de=function(){function e(e){this.tagBuilderSettings=[new Map,new Map],this.delimiters=null!=e?e:ue,this.lexer=pe(this.delimiters),this.grammar=ee.Grammar.fromCompiled(ie(this.lexer))}return e.prototype.update=function(e){this.delimiters=Object.assign({},ue,e),this.lexer=pe(this.delimiters),this.grammar=ee.Grammar.fromCompiled(ie(this.lexer))},e.prototype.parse=function(e){return re.push(this.tagBuilderSettings,this.delimiters),he(e,this.grammar)},e.prototype.rawParse=function(e){return re.push(this.tagBuilderSettings,this.delimiters),fe(e,this.grammar)},e}(),me=function(){function e(e,t,n){this.textFragments=e,this.parser=new de(n),this.nodes=null!=t?t:this.parser.parse(e)}return e.make=function(t,n){return new e([t],null,n)},e.makeFromFragments=function(t,n){return new e(t,null,n)},e.prototype.render=function(e,t){var n=this;void 0===t&&(t=function(){});for(var r={template:this,parser:this.parser},o=this.nodes,i=!1,u=function(t){var u={iteration:t},s=e.makeAccessor(r,u);o=o.flatMap((function(e,t){return e.evaluate(n.parser,s,[t])})),i=o.reduce(q,!0),e.finishIteration(r,u)},a=0;a<50&&!i;a++)u(a);var c=function(e){var t,n,r=[];if(0===e.length)return r;var o="";try{for(var i=s(e),u=i.next();!u.done;u=i.next()){var a=u.value.toString();"string"==typeof a?o+=a:(r.push(o),o="")}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.push(o),r}(o);return t(c),e.finishRun(r,{result:c}),c},e}(),ve=function(e,t,n){return e<0?n+e+1:t+e},ye=function(e,t){var n;if("string"==typeof e)return e;var r=null;switch(e.nodeType){case Node.TEXT_NODE:return null!==(n=e.textContent)&&void 0!==n?n:"";case Node.ELEMENT_NODE:return r=e,t?r.outerHTML:r.innerHTML;case xe.CHILD_NODE_SPAN:return e.spanAsStrings().join("");default:return""}},ge={type:"index",value:0},be={type:"index",value:-1},xe=function(){function e(t,n,r){var o,i,u,s;void 0===n&&(n=ge),void 0===r&&(r=be),this.nodeType=e.CHILD_NODE_SPAN,this.parentElement=t,this.childNodes=Array.from(this.parentElement.childNodes),this.max=t.childNodes.length-1;var a=this.getFromMethod(n.type),c=this.getToMethod(r.type);this._fromIndex=a.call(this,n.value,null!==(o=n.startAtIndex)&&void 0!==o?o:0,null!==(i=n.exclusive)&&void 0!==i&&i),this._toIndex=c.call(this,r.value,Math.max(null!==(u=r.startAtIndex)&&void 0!==u?u:0,this.from),null!==(s=r.exclusive)&&void 0!==s&&s)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),e.prototype.getFromMethod=function(e){return"index"===e?this.fromIndex:"node"===e?this.fromNode:this.fromPredicate},e.prototype.getToMethod=function(e){return"index"===e?this.toIndex:"node"===e?this.toNode:this.toPredicate},e.prototype.fromSafe=function(e,t){return e<t||e>this.max?this.max:e},e.prototype.fromIndex=function(e,t,n){var r=ve(e,t,this.max)+(n?1:0);return this.fromSafe(r,t)},e.prototype.fromNode=function(e,t,n){var r=this.childNodes.slice(t).findIndex((function(t){return t===e}))+t+(n?1:0);return this.fromSafe(r,t)},e.prototype.fromPredicate=function(e,t,n){var r=this.childNodes.slice(t).findIndex(e)+t+(n?1:0);return this.fromSafe(r,t)},e.prototype.toSafe=function(e,t){return e<t||e>this.max?0:e},e.prototype.toIndex=function(e,t,n){var r=ve(e,t,this.max)-(n?1:0);return this.toSafe(r,t)},e.prototype.toNode=function(e,t,n){var r=this.childNodes.slice(t).findIndex((function(t){return t===e}))+t-(n?1:0);return this.toSafe(r,t)},e.prototype.toPredicate=function(e,t,n){var r=this.childNodes.slice(t).findIndex(e)+t-(n?1:0);return this.toSafe(r,t)},Object.defineProperty(e.prototype,"valid",{get:function(){return this._fromIndex<=this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return Math.max(0,this._toIndex-this._fromIndex+1)},enumerable:!1,configurable:!0}),e.prototype.getRootNode=function(){return this.parentElement.getRootNode()},e.prototype.span=function(){return this.valid?this.childNodes.slice(this._fromIndex,this._toIndex+1):[]},e.prototype.spanAsStrings=function(){return this.span().map((function(e){return ye(e,!0)}))},e.prototype.replaceSpan=function(e){var t,n;if(this.valid){var r=document.createElement("div"),o=this.parentElement.childNodes.length;this.parentElement.insertBefore(r,this.parentElement.childNodes[this._fromIndex]);try{for(var i=s(this.span()),u=i.next();!u.done;u=i.next()){var a=u.value;this.parentElement.removeChild(a)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}r.outerHTML=e,this.childNodes=Array.from(this.parentElement.childNodes),this.max=this.childNodes.length,this._toIndex=this._toIndex+(this.max-o)}},e.CHILD_NODE_SPAN=3353,e}(),Ae=function(e,t){return void 0===t&&(t=0),[{type:"predicate",value:e.value,startAtIndex:t,exclusive:!1},{type:"predicate",value:function(t){return!e.value(t)},startAtIndex:t,exclusive:!0}]},we=function(e,t){for(var n=[],r=new(xe.bind.apply(xe,c([void 0,e],Ae(t))));r.valid;)n.push(r),r=new(xe.bind.apply(xe,c([void 0,e],Ae(t,r.to+1))));return n},ke=function(e,t){var n=document.createElement("style");return n.type="text/css",n.id="closet-"+e,n.textContent=t,n},Ee=function(e,t){return Boolean(e.getElementById("closet-"+t))},Fe=function(e,t){Ee(document,e)||document.head.appendChild(ke(e,t))},Se=function(e){function t(t,n,r,o){var i=e.call(this,t,n,o)||this;return i.inputs=r,i}return o(t,e),t.makeFromNode=function(e,n){return t.makeFromNodes([e],n)},t.makeFromNodes=function(e,n){return new t(e.map((function(e){return ye(e,!1)})),null,e,n)},t.prototype.renderToNodes=function(t){var n=this;e.prototype.render.call(this,t,(function(e){return e.forEach((function(e,t){return function(e,t){if("string"!=typeof e){var n=null,r=null;switch(e.nodeType){case Node.TEXT_NODE:n=e,r=document.createElement("div"),n.parentElement&&(n.parentElement.insertBefore(r,n),n.parentElement.removeChild(n)),r.outerHTML=t;break;case Node.ELEMENT_NODE:e.innerHTML=t;break;case xe.CHILD_NODE_SPAN:e.replaceSpan(t)}}}(n.inputs[t],e)}))}))},t.prototype.appendDocumentStyle=function(e,t){Fe(e,t)},t.prototype.appendStyle=function(e,t,n){!function(e,t,n){var r=e.getRootNode();r instanceof Document?Fe(t,n):Ee(r,t)||r.insertBefore(ke(t,n),r.firstElementChild)}(e,t,n)},t.prototype.appendStyleAll=function(e,t){var n,r;try{for(var o=s(this.inputs),i=o.next();!i.done;i=o.next()){var u=i.value;"string"!=typeof u&&this.appendStyle(u,e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},t}(me),Ce=function(){var e,t;try{for(var n=s(Array.from(document.getElementsByClassName("closet-delay"))),r=n.next();!r.done;r=n.next()){r.value.style.visibility="visible"}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},Be=Object.freeze({__proto__:null,BrowserTemplate:Se,cleanup:Ce,interspliceChildNodes:we}),Ne=ae.compile({text:{match:/[a-zA-Z_]+/u},numDigits:{match:/\d+(?=:|$)/u},digits:{match:/\d+/u},slash:{match:"/"},escapeseq:{match:/%\w/u},multiplierSeq:{match:/\*n\+/u},allStar:{match:/^\*$/u},numStar:{match:/\*(?=:|$)/u},star:{match:"*"},groupOpen:{match:"{"},groupAlternative:{match:","},rangeSpecifier:{match:/-/u},numGroupClose:{match:/\}(?=:|$)/u},groupClose:{match:"}"},occurSep:{match:":"}});function De(e){return e[0]}var Oe,_e={Lexer:Ne,ParserRules:[{name:"start",symbols:["allStar"],postprocess:De},{name:"start",symbols:["pattern"],postprocess:De},{name:"allStar",symbols:[Ne.has("allStar")?{type:"allStar"}:allStar],postprocess:function(){return function(){return!0}}},{name:"pattern",symbols:["key","num","occur"],postprocess:function(e){var t=a(e,3),n=t[0],r=t[1],o=t[2];return function(e,t,i){if(void 0===t){var u=e.match(te);if(!u)return!1;var s=u[1],a=Number(u[2]),c=Number.isNaN(a)?null:a;return n.test(s)&&r(c)&&o(i)}return n.test(e)&&r(t)&&o(i)}}},{name:"key$ebnf$1$subexpression$1",symbols:["keyComps"]},{name:"key$ebnf$1",symbols:["key$ebnf$1$subexpression$1"]},{name:"key$ebnf$1$subexpression$2",symbols:["keyComps"]},{name:"key$ebnf$1",symbols:["key$ebnf$1","key$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"key",symbols:["key$ebnf$1"],postprocess:function(e){var t=a(e,1)[0];return new RegExp("^"+t.join("")+"$","u")}},{name:"keyComps",symbols:["mixedText"],postprocess:De},{name:"keyComps",symbols:["escapeseq"],postprocess:De},{name:"keyComps",symbols:["keyGroup"],postprocess:De},{name:"mixedText",symbols:[Ne.has("text")?{type:"text"}:text],postprocess:function(e){return a(e,1)[0].value}},{name:"mixedText",symbols:[Ne.has("star")?{type:"star"}:star],postprocess:function(){return".*"}},{name:"mixedText",symbols:[Ne.has("slash")?{type:"slash"}:slash],postprocess:function(){return"\\\\"}},{name:"escapeseq",symbols:[Ne.has("escapeseq")?{type:"escapeseq"}:escapeseq],postprocess:function(e){return a(e,1)[0].value}},{name:"keyGroup",symbols:[Ne.has("groupOpen")?{type:"groupOpen"}:groupOpen,"keyGroupInner",Ne.has("groupClose")?{type:"groupClose"}:groupClose],postprocess:function(e){return a(e,2)[1].join("")}},{name:"keyGroupInner$ebnf$1",symbols:[]},{name:"keyGroupInner$ebnf$1$subexpression$1",symbols:[Ne.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"keyGroupItem"]},{name:"keyGroupInner$ebnf$1",symbols:["keyGroupInner$ebnf$1","keyGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"keyGroupInner",symbols:["keyGroupItem","keyGroupInner$ebnf$1"],postprocess:function(e){var t=a(e,2);return c([t[0]],t[1].map((function(e){return e.value})))}},{name:"keyGroupItem$ebnf$1",symbols:[]},{name:"keyGroupItem$ebnf$1$subexpression$1",symbols:["mixedText"]},{name:"keyGroupItem$ebnf$1",symbols:["keyGroupItem$ebnf$1","keyGroupItem$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"keyGroupItem",symbols:["keyGroupItem$ebnf$1"],postprocess:function(e){return a(e,1)[0].join("")}},{name:"num$ebnf$1$subexpression$1",symbols:["numPredicate"]},{name:"num$ebnf$1",symbols:["num$ebnf$1$subexpression$1"],postprocess:De},{name:"num$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"num",symbols:["num$ebnf$1"],postprocess:function(e){var t=a(e,1)[0];return t?t[0]:function(e){return null===e}}},{name:"numPredicate",symbols:["numDigits"],postprocess:De},{name:"numPredicate",symbols:["numStar"],postprocess:De},{name:"numPredicate",symbols:["numGroup"],postprocess:De},{name:"numDigits",symbols:[Ne.has("numDigits")?{type:"numDigits"}:numDigits],postprocess:function(e){var t=a(e,1)[0];return function(e){return e===Number(t.value)}}},{name:"numStar",symbols:[Ne.has("numStar")?{type:"numStar"}:numStar],postprocess:function(){return function(e){return!0}}},{name:"numGroup",symbols:[Ne.has("groupOpen")?{type:"groupOpen"}:groupOpen,"numGroupInner",Ne.has("numGroupClose")?{type:"numGroupClose"}:numGroupClose],postprocess:function(e){var t=a(e,2)[1];return function(e){return t.reduce((function(t,n){return t||n(e)}),!1)}}},{name:"numGroupInner$ebnf$1",symbols:[]},{name:"numGroupInner$ebnf$1$subexpression$1",symbols:[Ne.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"numGroupItem"]},{name:"numGroupInner$ebnf$1",symbols:["numGroupInner$ebnf$1","numGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"numGroupInner",symbols:["numGroupItem","numGroupInner$ebnf$1"],postprocess:function(e){var t=a(e,2);return c([t[0]],t[1].map((function(e){return a(e,2)[1]})))}},{name:"numGroupItem$ebnf$1$subexpression$1",symbols:["numGroupPredicate"]},{name:"numGroupItem$ebnf$1",symbols:["numGroupItem$ebnf$1$subexpression$1"],postprocess:De},{name:"numGroupItem$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"numGroupItem",symbols:["numGroupItem$ebnf$1"],postprocess:function(e){var t=a(e,1)[0];return t?t[0]:function(e){return null===e}}},{name:"numGroupPredicate",symbols:["digits"],postprocess:De},{name:"numGroupPredicate",symbols:["range"],postprocess:De},{name:"numGroupPredicate",symbols:["multiple"],postprocess:De},{name:"digits",symbols:[Ne.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=a(e,1)[0];return function(e){return e===Number(t.value)}}},{name:"range",symbols:["bounded"],postprocess:De},{name:"range",symbols:["leftBounded"],postprocess:De},{name:"range",symbols:["rightBounded"],postprocess:De},{name:"bounded",symbols:[Ne.has("digits")?{type:"digits"}:digits,Ne.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier,Ne.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=a(e,3),n=t[0],r=t[2];return function(e){return"number"==typeof e&&Number(n.value)<=e&&e<=Number(r.value)}}},{name:"leftBounded",symbols:[Ne.has("digits")?{type:"digits"}:digits,Ne.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier],postprocess:function(e){var t=a(e,1)[0];return function(e){return"number"==typeof e&&Number(t.value)<=e}}},{name:"rightBounded",symbols:[Ne.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier,Ne.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=a(e,2)[1];return function(e){return"number"==typeof e&&e<=Number(t.value)}}},{name:"multiple",symbols:[Ne.has("digits")?{type:"digits"}:digits,Ne.has("multiplierSeq")?{type:"multiplierSeq"}:multiplierSeq,Ne.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=a(e,3),n=t[0],r=t[2];return function(e){return(e-r)%n==0}}},{name:"occur$ebnf$1$subexpression$1",symbols:[Ne.has("occurSep")?{type:"occurSep"}:occurSep,"occurPredicate"]},{name:"occur$ebnf$1",symbols:["occur$ebnf$1$subexpression$1"],postprocess:De},{name:"occur$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"occur",symbols:["occur$ebnf$1"],postprocess:function(e){var t=a(e,1)[0];return t?function(e){return null===e||t[1](e)}:function(){return!0}}},{name:"occurPredicate",symbols:["numDigits"],postprocess:De},{name:"occurPredicate",symbols:["numStar"],postprocess:De},{name:"occurPredicate",symbols:["occurGroup"],postprocess:De},{name:"occurGroup",symbols:[Ne.has("groupOpen")?{type:"groupOpen"}:groupOpen,"occurGroupInner",Ne.has("groupClose")?{type:"groupClose"}:groupClose],postprocess:function(e){var t=a(e,2)[1];return function(e){return t.reduce((function(t,n){return n||t(e)}),!1)}}},{name:"occurGroupInner$ebnf$1",symbols:[]},{name:"occurGroupInner$ebnf$1$subexpression$1",symbols:[Ne.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"numGroupPredicate"]},{name:"occurGroupInner$ebnf$1",symbols:["occurGroupInner$ebnf$1","occurGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"occurGroupInner",symbols:["numGroupPredicate","occurGroupInner$ebnf$1"],postprocess:function(e){var t=a(e,2);return c([t[0]],t[1].map((function(e){return a(e,2)[1]})))}}],ParserStart:"start"},$e=ee.Grammar.fromCompiled(_e),Te=function(){function e(e){this.predicate=function(e){var t=new ee.Parser($e);try{var n=t.feed(e).results;return n.length>1&&console.log("Tag selector is ambiguous: ",e,n),n[0]}catch(e){return console.log("Tag selector failed to parse: ",e),function(){return!1}}}(e)}return e.make=function(t){return new e(t)},e.prototype.check=function(e,t,n){return void 0===n&&(n=null),this.predicate(e,t,n)},e.prototype.checkFullKey=function(e,t){return void 0===t&&(t=null),this.predicate(e,void 0,t)},e.prototype.checkTagIdentifier=function(e){var t=e.match(te);if(!t)return!1;var n=t[1],r=t[2].length>0?Number(t[2]):null,o=t[3]?Number(t[3]):null;return this.predicate(n,r,o)},e}(),Ie=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!globalThis.closetDebug)return!1;var n=Object.assign(document.createElement("div"),{className:"closet-log",innerText:e.map(String).join("\n")}),r=document.getElementById("qa");return!!r&&(r.appendChild(n),!0)},je="github.com/hgiesel/closet",Pe=function(){function e(){this._isAvailable=!1;try{"object"==typeof globalThis.sessionStorage&&(this._isAvailable=!0)}catch(e){}}return e.prototype.clear=function(){for(var e=0;e<sessionStorage.length;e++){var t=sessionStorage.key(e);t&&0===t.indexOf(je)&&(sessionStorage.removeItem(t),e--)}},e.prototype.setItem=function(e,t){sessionStorage.setItem(je+e,JSON.stringify(t))},e.prototype.getItem=function(e){var t,n=null!==(t=sessionStorage.getItem(je+e))&&void 0!==t?t:"null";return JSON.parse(n)},e.prototype.removeItem=function(e){sessionStorage.removeItem(je+e)},e.prototype.isAvailable=function(){return this._isAvailable},e}(),ze=function(){function e(e){this._isAvailable=!1,this.obj=globalThis[e],"object"==typeof this.obj&&(this._isAvailable=!0,void 0===this.obj[je]&&this.clear())}return e.prototype.clear=function(){this.obj[je]={}},e.prototype.setItem=function(e,t){this.obj[je][e]=t},e.prototype.getItem=function(e){return null==this.obj[je][e]?null:this.obj[je][e]},e.prototype.removeItem=function(e){delete this.obj[je][e]},e.prototype.isAvailable=function(){return this._isAvailable},e}(),Me=function(){var e;if((e=new Pe).isAvailable())return Ie("Used Persistence sessionStorage implementation"),e;if((e=new ze("py")).isAvailable())return Ie("Used Persistence windowKey py implementation"),e;var t=location.toString().indexOf("title"),n=location.toString().indexOf("main",t);return t>0&&n>0&&n-t<10?(Ie("Used Persistence windowKey qt implementation"),new ze("qt")):(Ie("Defaulted to Persistence windowKey implementation"),e)}();!function(e){e[e.ClosetImmediately=1]="ClosetImmediately",e[e.DesktopShownHook=2]="DesktopShownHook",e[e.MobileMathJax=3]="MobileMathJax",e[e.DesktopMobileLate=4]="DesktopMobileLate",e[e.Web=5]="Web"}(Oe||(Oe={}));var Le,Ge,Re,qe,He=function(e){switch(e){case Oe.ClosetImmediately:return"You have set the variable globalThis.closetImmediately.";case Oe.DesktopShownHook:return"Closet executes while MathJax is still rendering. You are on AnkiDesktop. The action will be pushed onto onShownHook.";case Oe.MobileMathJax:return"Closet executes while MathJax is still rendering. You are on AnkiMobile. The action will be enqueued on MathJax.Hub.Queue.";case Oe.DesktopMobileLate:return"Closet executes after MathJax finished rendering. The action will be executed immediatley.";case Oe.Web:return"You are on AnkiWeb, which does not have MathJax. Alternatively, you are on platform with MathJax 3. The action will be executed immediatley.";default:return"No Description found. This should never happen."}},Je={raw:function(e){return e()},viaShownHook:function(e){return globalThis.onShownHook.push(e)},viaMathJaxQueue:function(e){return globalThis.MathJax.Hub.Queue(e)}},Ke=function(){var e=globalThis.MathJax.Hub.queue,t=Object.assign({},e);return t.queue=t.queue.map(String),t},Ye=function(e){var t=a(function(){if(globalThis.closetImmediately)return[Je.raw,Oe.ClosetImmediately,[]];try{var e=globalThis._updatingQA,t=Ke();if(e){var n=globalThis.onShownHook;return n?[Je.viaShownHook,Oe.DesktopShownHook,[JSON.stringify(n.map(String)),JSON.stringify(t)]]:[Je.viaMathJaxQueue,Oe.MobileMathJax,[JSON.stringify(t)]]}return[Je.raw,Oe.DesktopMobileLate,[JSON.stringify(t)]]}catch(e){return[Je.raw,Oe.Web,[e]]}}(),3),n=t[0],r=t[1],o=t[2];Ie.apply(void 0,c(["Init mode "+r,He(r)],o)),n(e)},We=function(e,t,n,r){var o=window.performance.now();return Se.makeFromNodes(e,null==r?void 0:r.delimiters).renderToNodes(n),t.writeBack(),window.performance.now()-o},Xe=function(e,t,n,r,o){var i,u,s=function(e,t,n){return{card:e,cardNumber:(r=e,Number(r.match(/[0-9]*$/))),tagsFull:t,tags:0===t.length?[]:t.split(" "),side:n};var r}(n,r,o),a=function(e,t){return function(n){var r,o=null!==(r=globalThis.closetCardHash)&&void 0!==r?r:null,i=function(){if(!Me.isAvailable())return new Map;if("front"===e){var r=function(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}(t);if(r!==o)return globalThis.closetCardHash=r,new Map}var i=Me.getItem(n);return new Map(i)}();return{key:n,map:i,writeBack:function(){if(Me.isAvailable()){var e=Array.from(i.entries());Me.setItem(n,e)}}}}}(o,null!==(u=null===(i=document.getElementById("qa"))||void 0===i?void 0:i.innerHTML)&&void 0!==u?u:"");return t(e,s,a).map((function(e){return We.apply(void 0,c(e))}))},Ue=function(e){return function(e){return e.nodeType===Node.ELEMENT_NODE}(e)&&(function(e){return"STYLE"===e.tagName}(e)||function(e){return function(e){return"SCRIPT"===e.tagName}(e)&&(0===e.type.length||e.type.endsWith("javascript"))}(e)||function(e){return"anki-am"===e.id}(e))},Ve=Object.freeze({__proto__:null,init:Xe,initialize:function(e,t,n,r,o){return Ye((function(){return function(e,t,n,r,o){try{var i=Xe(e,t,n,r,o);console.log("Closet executed in "+i.map((function(e){return e.toFixed(3)}))+"ms.")}catch(e){console.log("An error occured while executing Closet:",e),Ie("An error occured while executing Closet",e)}finally{Ce()}}(e,t,n,r,o)})),e},ankiLog:Ie,getQaChildNodes:function(){if(!globalThis.document)return null;var e=globalThis.document.getElementById("qa");return e?we(e,{type:"predicate",value:function(e){return!Ue(e)}}):null}}),Qe=Object.freeze({__proto__:null,Template:me,BrowserTemplate:Se,Parser:de,TagSelector:Te,browser:Be,anki:Ve,optics:R}),Ze=I({sep:";"}),et=I({sep:"=",trim:!0,max:2}),tt=function(){function e(e){this.defaultValue=e,this.selectors=[]}return e.prototype.set=function(e,t){this.selectors.unshift([Te.make(e),t])},e.prototype.get=function(e,t,n){var r=this.selectors.find((function(r){return a(r,1)[0].check(e,t,n)}));return r?r[1]:this.defaultValue},e}(),nt=function(e){return function(t,n,r){return function(o,i){var u=i.cache;return o.values.forEach((function(o){u.over(t,r.apply(void 0,c(o)),new e(n))})),{ready:!0}}}},rt=nt(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.setNumber=function(e,t){this.set(e,Number.isNaN(t)?0:t)},t}(tt)),ot=nt(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.on=function(e){this.set(e,!0)},t.prototype.off=function(e){this.set(e,!1)},t}(tt)),it=function(e){return{get:function(){return e}}},ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.setList=function(e,t){this.set(e,t)},t.prototype.overwriteList=function(e,t,n){void 0===n&&(n=0);for(var r=this.getList(e),o=0;o<t.length;o++)r[n+o]=t[o];this.setList(e,r)},t.prototype.getList=function(e){return this.get(e,[])},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(g)),st=(Le=ut,function(e,t){return function(n,r){var o;return{ready:!0,result:null!==(o=r.cache.over(e,t(n,r),new Le(new Map)))&&void 0!==o?o:""}}}),at=function(e,t){return function(e,t){return""}},ct=(Ge=function(e,t,n){return function(r,o){return null===r.num?e.setList(t,n):e.overwriteList(t,n,r.num),""}},function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"setl":n,o=t.storeId,i=void 0===o?"lists":o,u=t.postprocess,s=void 0===u?at:u,c=t.optics,l=void 0===c?[I({sep:"::"}),function(e,t){return n=t,function(e){return e.map(n)};var n},I({sep:"||"})]:c;return function(e){return e.register(r,st(i,function(e,t){return function(n,r){return function(o){var i=a(2===n.values.length?n.values:[["default"],n.values[0]],2),u=i[0],s=i[1],c=u[0],l=o.getList(c),p=e(o,c,s)(n,r);return t(p,l)(n,r)}}}(Ge,s)),{optics:l})}}),lt=function(e,t,n,r){var o,i,s;return void 0===n&&(n=[]),void 0===r&&(r=function(){return!1}),u(this,(function(u){switch(u.label){case 0:o=[],i=0,u.label=1;case 1:return!r(n)&&i<1e3?(s=e(),n.includes(s)||o.includes(s)?[3,3]:(t&&o.push(s),[4,s])):[3,4];case 2:u.sent(),u.label=3;case 3:return i++,[3,1];case 4:return[2,o]}}))},pt=function(e,t){return function(){return e+Math.floor(Math.random()*(t-e))}},ft=function(e,t){return function(t,n){return e}},ht=function(e){return function(t){var n=void 0===t?{}:t,r=n.tagname,o=void 0===r?"pick":r,i=n.storeId,u=void 0===i?"lists":i,s=n.postprocess,a=void 0===s?ft:s;return function(t){return t.register(o,st(u,function(e,t){return function(n,r){return function(o){var i=n.values||"default",u=o.getList(i),s=e(u,i)(n,r);return t(s,u)(n,r)}}}(e,a)))}}},dt=ht((function(e,t){return function(n,r){var o=r.memory,i="pick:picked:"+n.fullKey+":"+n.occur,u=o.lazy(i,(function(){var r,i,u=pt(0,e.length),s=(r=0,i=e.length,function(e){return e.length>=i-r}),a=Boolean(n.num),c="pick:uniqList:"+n.fullKey,l=a?o.over(c,(function(e){return Object.prototype.hasOwnProperty.call(e,t)||(e[t]=[]),e}),{})[t]:[],p=Array.from(e).reduce((function(e,t,n){return void 0===t&&e.push(n),e}),[]),f=l.concat(p),h=lt(u,a,f,s).next();if(!h.done)return l.push(h.value),h.value}));return Number.isInteger(u)?e[u]:""}})),mt=ht((function(e,t){return function(t,n){return e[Number(t.num)||0]}})),vt=ht((function(e,t){return function(t,n){var r,o=e[n.preset.cardNumber];return null!==(r=null!=o?o:e[0])&&void 0!==r?r:""}})),yt=function(){function e(e,t,n){this.separator=e,this.mapper=t,this.processor=n}return e.make=function(t){var n=void 0===t?{}:t,r=n.separator,o=void 0===r?"":r,i=n.mapper,u=void 0===i?B:i,s=n.processor;return new e(o,u,void 0===s?B:s)},e.prototype.toStylizer=function(t){var n=void 0===t?{}:t,r=n.separator,o=void 0===r?this.separator:r,i=n.mapper,u=void 0===i?this.mapper:i,s=n.processor;return new e(o,u,void 0===s?this.processor:s)},e.prototype.stylize=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return this.processor(e.flatMap((function(e,r,o){return t.mapper.apply(t,c([e,r],n.map((function(e){return e[r]})),[o]))})).join(this.separator))},e.prototype.stylizeFull=function(e,t,n){var r=this;return void 0===t&&(t=[]),void 0===n&&(n=[]),this.processor.apply(this,c([e.flatMap((function(e,n,o){return r.mapper.apply(r,c([e,n],t.map((function(e){return e[n]})),[o]))})).join(this.separator)],n))},e}(),gt=function(e){return function(t){var n=(void 0===t?{}:t).tagname,r=void 0===n?"s":n;return function(t){t.register(r,e)}}},bt=function(e){return function(t){return e(t.values)}},xt=function(e){return function(t,n){return function(r,o){var i=a(e(r,o),2),u=i[0],s=i[1];return o.cache.over("sequences",(function(e){e.includes(s)||e.push(s)}),[]),function(e,t,n,r){return function(o,i){var u=e+":apply",s=e+":length",a=t+":waitingSet",c=t+":shuffle";if(i.cache.get(u,!1)){if(i.cache.get(a,new Set).size>0)return;for(var l=[],p=i.cache.get(c,[]),f=i.cache.get(s,0),h=0;h<f;h++){var d=p.shift();d&&l.push(d)}return l}if(i.ready){var m=r(o,i);if(0===m.length)return m;i.cache.fold(c,(function(e){return e.concat(m)}),[]),i.cache.set(s,m.length),i.deferred.registerIfNotExists(u,(function(){i.cache.set(u,!0),i.cache.over(a,(function(t){return t.delete(e)}),new Set)}),{priority:65}),i.deferred.registerIfNotExists(c,(function(){i.cache.over(a,(function(e){return e.size>0}),new Set)||i.cache.fold(c,(function(e){var t=i.memory.fold(c,(function(e){return n(e,i.cache.get(c,[]).length)}),[]);return O(e,t)}),[])}))}else i.cache.over(a,(function(t){return t.add(e)}),new Set)}}(u,s,n,t)(r,o)}}},At=xt((function(e,t){var n=e.fullKey,r=e.fullOccur;return[n+":"+r,n+":"+r]})),wt=xt((function(e,t){var n=e.fullKey;return[n+":"+e.fullOccur,n]})),kt=xt((function(e,t){var n=e.fullKey,r=e.fullOccur;return[n+":"+r,e.num?n:n+":"+r]})),Et=Object.freeze({__proto__:null,withinTag:At,acrossTag:wt,acrossNumberedTag:kt,withinCustom:function(e){return xt(function(e){return function(t,n){var r=t.fullKey,o=t.fullOccur,i=t.num;return[r+":"+o,""+e+i+":"+o]}}(e))},acrossCustom:function(e){return xt(function(e){return function(t,n){var r=t.fullKey,o=t.fullOccur,i=t.num;return[r+":"+o,""+e+i]}}(e))},acrossNumberedCustom:function(e){return xt(function(e){return function(t,n){var r=t.fullKey,o=t.fullOccur,i=t.num,u=""+e+i;return[r+":"+o,i?u:u+":"+o]}}(e))}}),Ft=function(e,t){if(e.length>=t)return e;var n=function(e){for(var t=e.slice(0),n=e.length;0!==n;){var r=Math.floor(Math.random()*n),o=t[n-=1];t[n]=t[r],t[r]=o}return t}(Array.from(new Array(t-e.length),(function(t,n){return n+e.length})));return c(e,n)},St=Object.freeze({__proto__:null,topUp:Ft,mixIn:function(e,t){if(e.length>=t)return e;var n=Array.from(new Array(t-e.length),(function(t,n){return n+e.length})),r=c(e);return n.forEach((function(e){return r.splice(Math.floor(Math.random()*(r.length+1)),0,e)})),r}}),Ct=yt.make({processor:function(e){return'<span class="closet-shuffle">'+e+"</span>"},mapper:function(e){return'<span class="closet-shuffle__item">'+e+"</span>"},separator:'<span class="closet-shuffle__separator"></span>'}),Bt=function(e,t){return function(){return e.stylize(t)}},Nt=[I({sep:"||"})],Dt={priority:35,persistent:!0},Ot=[I("::"),function(e,t){return n=t,function(e){return e.map(n)};var n},I(",")],_t=[I({sep:","})],$t=function(e,t,n){return function(r){var o=void 0===r?{}:r,i=o.tagname,u=void 0===i?"gen":i,s=o.uniqueConstraintId,c=void 0===s?"uniq":s,l=o.optics,p=void 0===l?_t:l;return function(r){var o="gen:"+c;r.register(u,(function(r,i){var s=r.values,c=r.fullOccur,l=r.num,p=i.memory,f=a(1===s.length?[1,Number(s[0]),n]:s.map(Number),3),h=f[0],d=void 0===h?1:h,m=f[1],v=void 0===m?100:m,y=f[2],g=void 0===y?n:y,b=Number.isInteger(l)?o+":"+l:o,x="gen:"+u+":"+c;return{ready:!0,result:p.lazy(x,(function(){var n=lt(e(d,v),!0,Number.isInteger(l)?p.get(b,[]):[]).next();return n.done?"":t(n.value,g)}))}}),{optics:p})}}},Tt=$t(pt,(function(e,t){return String(e*t)}),1),It=$t((function(e,t){return function(){return e+Math.random()*(t-e)}}),(function(e,t){return e.toFixed(t)}),2),jt=/%(.)/gu,Pt={optics:[I({sep:"::",max:2})],capture:!0},zt={inlineOptics:[I({sep:"::",max:2})],capture:!0},Mt=Object.freeze({__proto__:null,apply:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"s":n,o=t.apply,i=void 0===o?bt(B):o,u=t.optics,s=void 0===u?[]:u;return function(e){e.register(r,i,{optics:s})}},process:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"s":n,o=t.processor,i=void 0===o?B:o,u=t.optics,s=void 0===u?[]:u;return function(e){e.register(r,bt(i),{optics:s})}},style:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"s":n,o=t.stylizer,i=void 0===o?yt.make():o,u=t.optics,s=void 0===u?[I("::")]:u;return function(e){e.register(r,bt(i.stylize.bind(i)),{optics:s})}},shuffle:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"mix":n,o=t.stylizer,i=void 0===o?Ct:o,u=t.evaluate,s=void 0===u?Bt:u,a=t.sortInStrategy,c=void 0===a?Ft:a,l=t.sequencer,p=void 0===l?kt:l,f=t.optics,h=void 0===f?Nt:f;return function(e){e.register(r,(function(e,t){var n=p((function(e){var t=e.values;return null!=t?t:[]}),c),r=n(e,t);if(r)return s(i,r)(e,t)}),{optics:h})}},order:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"ord":n,o=t.optics,i=void 0===o?Ot:o,u=t.sortInStrategy,c=void 0===u?Ft:u;return function(e){e.register(r,(function(e,t){var n,r,o=t.deferred,i=t.cache,u=t.memory,l=new Set(i.get("sequences",[])),p=function(t,n){var r=n.map(Te.make),p=e.key+":"+e.fullOccur+":ord:"+t;o.register(p,(function(){var e,t,n=Array.from(l).filter((function(e){return!!r.some((function(t){return t.checkTagIdentifier(e)}))&&(l.delete(e),!0)})),f=n.map((function(e){return e+":shuffle"})),h=function(e,t){var n=f[e],r=t+":waitingSet";if(o.block(n),0!==i.get(r,new Set).size)return"continue";var s=f.reduce((function(e,t){var n=u.get(t,[]);return e.length<n.length?n:e}),[]),a=i.get(n,[]),l=c(i.get(p,s),a.length);i.fold(n,(function(e){return O(e,l)}),[]),i.set(p,l),u.set(n,l)};try{for(var d=(e=void 0,s(n.entries())),m=d.next();!m.done;m=d.next()){var v=a(m.value,2);h(v[0],v[1])}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}0===l.size&&o.unregister(p)}),Dt)};try{for(var f=s(e.values.entries()),h=f.next();!h.done;h=f.next()){var d=a(h.value,2);p(d[0],d[1])}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}return{ready:!0}}),{optics:i})}},generateInteger:Tt,generateReal:It,debug:function(){return function(e){e.register("tagpath",(function(e,t){return t.path.join(":")})),e.register("never",(function(){})),e.register("empty",(function(){return""})),e.register("key",(function(e){return e.key})),e.register("stopIteration",(function(e,t){var n=e.values,r=t.filters,o=Number(n),i=r.getOrDefault("base");return r.register("base",(function(e,t){var n;return t.iteration>=o?null!==(n=e.text)&&void 0!==n?n:"":i(e,t)})),{ready:!0}})),e.register("memorytest",(function(e,t){var n=t.memory;return String(n.fold("base:memorytest",(function(e){return++e}),0))}))}},define:function(e){return void 0===e&&(e={}),function(t){var n=e.tagname,r=void 0===n?"def":n,o={optics:[I({sep:"::"})]};t.register(r,(function(e){var n=a(e.values,2),r=n[0],i=n[1];return t.register(r,(function(e){var t=i.replace(jt,function(e){return function(t,n){var r,o=null;switch(n){case"%":return n;case"n":return"number"==typeof e.num?String(e.num):"";case"k":return e.key;case"f":return e.fullKey;default:return o=Number(n),Number.isNaN(o)?t:null!==(r=e.values[o])&&void 0!==r?r:""}}}(e));return{result:t,parse:!0}}),o),{ready:!0}}),Pt)}},delimiter:function(e){return void 0===e&&(e={}),function(t){var n=e.tagname,r=void 0===n?"delim":n;t.register(r,(function(e,t){var n=t.template;if(t.isCapture){var r=a(e.inlineValues,2),o=r[0],i=r[1];return n.parser.update({open:o,close:i}),{result:e.blockText,parse:!0}}return n.parser.update(),{result:e.innerNodes}}),zt)}},setNumber:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"set":n,o=t.storeId,i=void 0===o?"numerical":o,u=t.separator,s=void 0===u?Ze:u,a=t.assignmentSeparator,c=void 0===a?et:a;return function(e){return e.register(r,rt(i,0,(function(e,t){return function(n){return n.setNumber(e,Number(t))}})),{optics:[s,function(e,t){return n=t,function(e){return e.map(n)};var n},c]})}},activate:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"on":n,o=t.storeId,i=void 0===o?"active":o,u=t.optic,s=void 0===u?Ze:u;return function(e){return e.register(r,ot(i,!1,(function(e){return function(t){t.on(e)}})),{separators:[s,function(e,t){return n=t,function(e){return e.map(n)};var n},et]})}},deactivate:function(e){var t=void 0===e?{}:e,n=t.tagname,r=void 0===n?"off":n,o=t.storeId,i=void 0===o?"active":o,u=t.optic,s=void 0===u?Ze:u;return function(e){return e.register(r,ot(i,!1,(function(e){return function(t){return t.off(e)}})),{separators:[s,function(e,t){return n=t,function(e){return e.map(n)};var n},et]})}},constantGet:it,setList:ct,pick:dt,pickIndex:mt,pickCardNumber:vt}),Lt=function(e,t,n,r){return e-n<=t&&t<=e+r},Gt=function(e,t){var n=e.key,r=e.num,o=e.fullOccur,i=t.preset,u=t.cache,s=it(0),a=null,c=null;switch(r){case null:return!1;case 0:return!0;default:return"number"==typeof i.cardNumber&&(a=u.get("flashcardActiveBottom",s).get(n,i.cardNumber,o),c=u.get("flashcardActiveTop",s).get(n,i.cardNumber,o),Lt(i.cardNumber,r,a,c))}},Rt=function(e,t){return t.cache.get("flashcardActive",it(!1)).get(e.key,e.num,e.fullOccur)},qt=function(e,t){return Rt(e,t)||Gt(e,t)},Ht=function(e,t){return"back"===t.preset.side},Jt=Ht,Kt=Object.freeze({__proto__:null,isActiveWithinRange:Lt,isActive:function(e,t){var n=e.num,r=t.preset;switch(n){case null:return!1;case 0:return!0;default:return!!Object.prototype.hasOwnProperty.call(r,"cardNumber")&&n===r.cardNumber}},isActiveGetRange:Gt,isActiveOverwritten:Rt,isActiveAll:qt,isBack:Ht,isBackAll:Jt}),Yt=function(e){return Object.prototype.hasOwnProperty.call(e,"tagname")?[e.tagname]:[]},Wt=function(e,t){return i(i({},e),{tagname:t[0]})},Xt=function(e){return function(t,n){var r=void 0===n?{wrapId:"wrapped",getTagnames:Yt,setTagnames:Wt}:n,o=r.wrapId,i=r.getTagnames,u=r.setTagnames;return function(n){return void 0===n&&(n={}),function(r){var a,c,l=i(n),p=function(e){return e+":"+o+":internal"},f=new Map,h=l.map((function(e){var t=p(e);return f.set(e,t),t}));t(u(n,h))(r);var d=function(t,n){var r=f.get(t.key);return e(Object.assign({},t,{keyInternal:r}),n),n.filters.getOrDefault(r)(t,n)};try{for(var m=s(l),v=m.next();!v.done;v=m.next()){var y=v.value;r.register(y,d,r.getOptions(p(y)))}}catch(e){a={error:e}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(a)throw a.error}}}}}},Ut=function(e){return function(t,n,r,o){return void 0===r&&(r={}),void 0===o&&(o={wrapId:"wrapped",getTagnames:Yt,setTagnames:Wt}),Xt((function(t,o){e(o).registerIfNotExists(t.keyInternal,n,r)}))(t,o)}},Vt=Ut((function(e){return e.deferred})),Qt=Ut((function(e){return e.aftermath})),Zt=function(e,t,n,r){var o=void 0===r?{wrapId:"sum",getTagnames:Yt,setTagnames:Wt}:r,i=o.wrapId,u=o.setTagnames;return function(r){var o=void 0===r?{}:r,s=o.tagname,a=void 0===s?"sum":s,c=o.optionsFalse,l=void 0===c?{}:c,p=o.optionsTrue,f=void 0===p?{}:p;return function(r){var o=a+":"+i+":false",s=a+":"+i+":true";e(u(l,[o]))(r),t(u(f,[s]))(r);r.register(a,(function(e,t){return n(e,t)?t.filters.getOrDefault(s)(e,t):t.filters.getOrDefault(o)(e,t)}),r.getOptions(s))}}},en=function(e,t,n,r,o,i,u){var s=void 0===u?{wrapId:"sumFour",getTagnames:Yt,setTagnames:Wt}:u,a=s.wrapId,c=s.setTagnames;return function(u){var s=void 0===u?{}:u,l=s.tagname,p=void 0===l?"sum":l,f=s.optionsZero,h=void 0===f?{}:f,d=s.optionsOne,m=void 0===d?{}:d,v=s.optionsTwo,y=void 0===v?{}:v,g=s.optionsThree,b=void 0===g?{}:g;return function(u){var s=p+":"+a+":zero",l=p+":"+a+":two";Zt(e,t,o)({tagname:s,optionsFalse:c(h,[s]),optionsTrue:c(m,[s])})(u),Zt(n,r,o)({tagname:l,optionsFalse:c(y,[l]),optionsTrue:c(b,[l])})(u);u.register(p,(function(e,t){return i(e,t)?t.filters.getOrDefault(l)(e,t):t.filters.getOrDefault(s)(e,t)}))}}},tn=function(e){return function(t){return function(n){var r,o,i=null!=t?t:{};try{for(var u=s(e),c=u.next();!c.done;c=u.next()){var l=a(c.value,2),p=l[0],f=l[1],h=void 0===f?{}:f,d=h.setTagnames,m=void 0===d?Wt:d,v=h.getTagnames;p(m(i,(void 0===v?Yt:v)(i)))(n)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}}}},nn=it(!1),rn=it(0),on=function(e,t){var n=t.cache,r=t.preset;if(!r.cardNumber)return[0,0,0,0];return[n.get("flashcardShowBottom",rn).get(e.key,r.cardNumber,e.fullOccur),n.get("flashcardShowTop",rn).get(e.key,r.cardNumber,e.fullOccur),n.get("flashcardHideBottom",rn).get(e.key,r.cardNumber,e.fullOccur),n.get("flashcardHideTop",rn).get(e.key,r.cardNumber,e.fullOccur)]},un=function(e){return function(t){return function(n,r){return function(o,i){return i.cache.get("flashcardShow",nn).get(o.key,o.num,o.fullOccur)?n(o,i):i.cache.get("flashcardHide",nn).get(o.key,o.num,o.fullOccur)?r(o,i):e(t)(n,r)(o,i)}}}}((Re=function(e){return function(t,n){return function(r,o){return e(t,n)(r,o)}}},function(e){return function(t,n){return function(r,o){if(!Object.prototype.hasOwnProperty.call(o.preset,"cardNumber"))return Re(e)(t,n)(r,o);var i=a(on(r,o),4),u=i[0],s=i[1],c=i[2],l=i[3],p=o.preset.cardNumber;return p&&r.num?p-u<=r.num&&r.num<=p+s?t(r,o):p-c<=r.num&&r.num<=p+l?n(r,o):Re(e)(t,n)(r,o):e(t,n)(r,o)}}})),sn=function(e,t,n){return void 0===e&&(e=qt),void 0===t&&(t=Jt),void 0===n&&(n=un),function(r,o){return function(i,u,s,a,c,l){return void 0===l&&(l={}),function(p){var f=i+":internal";en(gt(n(r)(a,c)),gt(u),gt(n(o)(a,c)),gt(s),e,t)({tagname:f})(p);p.register(i,(function(e,t){return t.filters.getOrDefault(f)(e,t)}),l)}}}};!function(e){e.Show="show",e.Hide="hide",e.Reveal="reveal"}(qe||(qe={}));var an=function(e){var t=e(B,B),n=e(N,N),r=e(N,B),o=a([[qe.Show,"s"],[qe.Hide,"h"],[qe.Reveal,"r"]].map((function(e){var t=a(e,2),n=t[0],r=t[1];return{getTagnames:function(e){var t,o;return[(null!==(t=e.defaultBehavior)&&void 0!==t?t:qe.Show)===n?e.tagname:null!==(o=e.tagnameShow)&&void 0!==o?o:""+e.tagname+r]}}})),3),i=o[0],u=o[1],s=o[2],c=tn([[n,u],[t,i],[r,s]]);return c.show=t,c.hide=n,c.reveal=r,c},cn=function(e){return Array.isArray(e[0])?e[0].map((function(t,n){return e.map((function(e){return e[n]}))})):[e]},ln=function(e,t){return function(n,r){return r.ready?e.stylize.apply(e,c(cn(t(n,r)))):{ready:!1}}},pn=function(e,t){return function(n,r){if(!r.ready)return{ready:!1};var o=t(n,r);return o?e.stylize.apply(e,c(cn(o))):{ready:!1}}},fn=D('<span class="closet-cloze is-inactive"><span class="closet-cloze__ellipsis"></span></span>'),hn=function(e){return function(t){return'<span class="closet-cloze is-active is-'+e+'">'+t+"</span>"}},dn=yt.make({processor:hn("front")}),mn=yt.make({processor:hn("back")}),vn=function(e,t){var n;return['<span class="closet-cloze__hint">'+(null!==(n=e.values[1])&&void 0!==n?n:"")+"</span>"]},yn=function(e){return'<span class="closet-cloze__answer">'+e.values[0]+"</span>"},gn=function(e,t){return{ready:t.ready,result:'<span  class="closet-cloze is-inactive">'+yn(e)+"</span>"}},bn=function(e){return[yn(e)]},xn=an((function(e,t){return function(n){void 0===n&&(n={});var r=n.tagname,o=void 0===r?"c":r,i=n.inactiveEllipser,u=void 0===i?fn:i,s=n.frontStylizer,a=void 0===s?dn:s,c=n.frontEllipser,l=void 0===c?vn:c,p=n.backStylizer,f=void 0===p?mn:p,h=n.backEllipser,d=void 0===h?bn:h,m=n.optics,v=void 0===m?[I({sep:"::",max:2})]:m,y=n.flashcardTemplate,g=void 0===y?sn():y,b=ln(a,l),x=ln(f,d),A={optics:v};return g(e,t)(o,b,x,gn,u,A)}})),An=D('<span class="closet-multiple-choice is-inactive"><span class="closet-multiple-choice__ellipsis"></span></span>'),wn=function(e){return e.values?e.values.flatMap((function(e,t){return e.map((function(e){return[e,t]}))})):[]},kn=function(e){return e.values[0]},En='<span class="closet-multiple-choice__separator"></span>',Fn=yt.make({processor:function(e){return'<span class="closet-multiple-choice is-inactive">'+e+"</span>"},mapper:function(e){return'<span class="closet-multiple-choice__item">'+e+"</span>"},separator:En}),Sn=function(e){return function(t){return'<span class="closet-multiple-choice is-active is-'+e+'">'+t+"</span>"}},Cn=yt.make({processor:Sn("front"),mapper:function(e){return'<span class="closet-multiple-choice__item closet-multiple-choice__option">'+e+"</span>"},separator:En}),Bn=yt.make({processor:Sn("back"),mapper:function(e,t,n){return'<span class="closet-multiple-choice__item closet-multiple-choice__'+(0===n?"correct":"wrong")+'">'+e+"</span>"},separator:En}),Nn=[I({sep:"::"}),function(e,t){return n=t,function(e){return e.map(n)};var n},I({sep:"||",keepEmpty:!1})],Dn=an((function(e,t){return function(n){void 0===n&&(n={});var r=n.tagname,o=void 0===r?"mc":r,i=n.frontStylizer,u=void 0===i?Cn:i,s=n.backStylizer,a=void 0===s?Bn:s,c=n.inactiveStylizer,l=void 0===c?Fn:c,p=n.contexter,f=void 0===p?kn:p,h=n.ellipser,d=void 0===h?An:h,m=n.getValues,v=void 0===m?wn:m,y=n.sequence,g=void 0===y?wt:y,b=n.sortInStrategy,x=void 0===b?Ft:b,A=n.optics,w=void 0===A?Nn:A,k=n.flashcardTemplate,E=void 0===k?sn():k,F=g(v,x),S=pn(u,F),C=pn(a,F);return E(e,t)(o,S,C,ln(l,f),d,{optics:w})}})),On=function(e){return{result:e.values,parse:!0}},_n=function(){return""},$n=an((function(e,t){return function(n){void 0===n&&(n={});var r=n.tagname,o=void 0===r?"spec":r,i=n.flashcardTemplate;return(void 0===i?sn():i)(e,t)(o,On,On,On,_n,{capture:!0})}})),Tn=function(e,t){return e.values},In=function(e){return function(t){return'<span class="closet-'+e+'__item">'+t+"</span>"}},jn=function(e){return'<span class="closet-'+e+'__separator"></span>'},Pn=function(e){return e.values?e.values:[]},zn=function(e,t){return ln(e,Tn)},Mn=[I({sep:"::"})],Ln=function(e,t,n){return function(r,o){return function(i){void 0===i&&(i={});var u,s=i.tagname,a=void 0===s?"shuf":s,c=i.activeStylizer,l=void 0===c?(u=e,yt.make({processor:function(e){return'<span class="closet-'+u+' is-active">'+e+"</span>"},mapper:In(u),separator:jn(u)})):c,p=i.inactiveStylizer,f=void 0===p?function(e){return yt.make({processor:function(t){return'<span class="closet-'+e+' is-inactive">'+t+"</span>"},mapper:In(e),separator:jn(e)})}(e):p,h=i.contexter,d=void 0===h?Pn:h,m=i.ellipser,v=void 0===m?function(e){return function(){return'<span class="closet-'+e+' is-inactive"><span class="closet-'+e+'__ellipsis"></span></span>'}}(e):m,y=i.sequence,g=void 0===y?wt:y,b=i.sortInStrategy,x=void 0===b?Ft:b,A=i.optics,w=void 0===A?Mn:A,k=i.flashcardTemplate,E=void 0===k?sn():k,F={optics:w},S=g(d,x),C=t(l,S),B=n(l,S),N=ln(f,d);return E(r,o)(a,C,B,N,v,F)}}},Gn={cloze:xn,multipleChoice:Dn,specification:$n,mingle:an(Ln("mingle",pn,pn)),sort:an(Ln("sort",pn,zn)),jumble:an(Ln("jumble",zn,pn))},Rn=Object.freeze({__proto__:null,recipes:Gn,deciders:Kt,get behaviors(){return qe}}),qn="A-Za-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16F1-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FD5\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC",Hn="0-9\\xB2\\xB3\\xB9\\xBC-\\xBE\\u0660-\\u0669\\u06F0-\\u06F9\\u07C0-\\u07C9\\u0966-\\u096F\\u09E6-\\u09EF\\u09F4-\\u09F9\\u0A66-\\u0A6F\\u0AE6-\\u0AEF\\u0B66-\\u0B6F\\u0B72-\\u0B77\\u0BE6-\\u0BF2\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0CE6-\\u0CEF\\u0D58-\\u0D5E\\u0D66-\\u0D78\\u0DE6-\\u0DEF\\u0E50-\\u0E59\\u0ED0-\\u0ED9\\u0F20-\\u0F33\\u1040-\\u1049\\u1090-\\u1099\\u1369-\\u137C\\u16EE-\\u16F0\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1946-\\u194F\\u19D0-\\u19DA\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1B50-\\u1B59\\u1BB0-\\u1BB9\\u1C40-\\u1C49\\u1C50-\\u1C59\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u2150-\\u2182\\u2185-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2CFD\\u3007\\u3021-\\u3029\\u3038-\\u303A\\u3192-\\u3195\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\uA620-\\uA629\\uA6E6-\\uA6EF\\uA830-\\uA835\\uA8D0-\\uA8D9\\uA900-\\uA909\\uA9D0-\\uA9D9\\uA9F0-\\uA9F9\\uAA50-\\uAA59\\uABF0-\\uABF9\\uFF10-\\uFF19",Jn=new RegExp("["+qn+"]","gu"),Kn=new RegExp("["+Hn+"]","gu"),Yn=new RegExp("["+qn+Hn+"]","gu"),Wn=Object.freeze({__proto__:null,unicodeLetterPattern:Jn,unicodeNumberPattern:Kn,unicodeAlphanumericPattern:Yn,key:ce,keySeparation:te}),Xn=/<img[^>]*?src="(.+?)"[^>]*>/g,Un=function(e){return e.textFragments.map((function(t,n){return[t,e.inputs[n]]})).flatMap((function(e){var t=a(e,2),n=t[0],r=t[1];return"string"==typeof r?[]:function(e,t){var n,r=[];do{(n=Xn.exec(e))&&r.push([n[1],t])}while(n);return r}(n,r.getRootNode())}))},Vn=function(e){if(navigator.userAgent.search("Chrome")>=0)return[e.offsetX,e.offsetY];var t=e.currentTarget,n=t.getBoundingClientRect(),r=t.parentElement.getBoundingClientRect();return[e.layerX-(r.left-n.left),e.layerY-(r.top-n.top)]},Qn=function(e,t,n){var r=t.querySelector(e);r&&(r.complete?n({target:r}):r.addEventListener("load",n))},Zn="\nimg {\n  max-width: 100% !important;\n}\n\n.closet-occlusion-container {\n  display: inline-block;\n  position: relative;\n}\n\n.closet-occlusion-container > * {\n  display: block;\n\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.closet-occlusion-container > svg {\n  position: absolute;\n  top: 0;\n}\n\n.closet-shape > text {\n  text-anchor: middle;\n  dominant-baseline: central;\n  pointer-events: none;\n}",er="http://www.w3.org/2000/svg",tr=function(){function e(e,t,n){var r=this;this.scaleFactorX=1,this.scaleFactorY=1,this.maxOcclusions=500,this.elements=[],this.container=e,this.image=t,this.svg=n,this.resizer=new globalThis.ResizeObserver((function(){return r.resize()})),this.resizer.observe(t),this.setScaleFactors()}return e.prototype.setScaleFactors=function(){this.scaleFactorX=this.image.width/this.image.naturalWidth,this.scaleFactorY=this.image.height/this.image.naturalHeight},e.wrapImage=function(t){var n=document.createElement("div");t.parentNode&&t.parentNode.replaceChild(n,t),n.appendChild(t);var r=document.createElementNS(er,"svg");r.setAttributeNS(null,"width","100%"),r.setAttributeNS(null,"height","100%");var o=window.getComputedStyle(t);return r.style.zoom=o.getPropertyValue("zoom"),r.style.transform=o.getPropertyValue("transform"),n.appendChild(r),n.classList.add("closet-occlusion-container"),new e(n,t,r)},Object.defineProperty(e.prototype,"scaleFactors",{get:function(){return[this.scaleFactorX,this.scaleFactorY]},enumerable:!1,configurable:!0}),e.prototype.resize=function(){var e,t;if(this.setScaleFactors(),this.scaleFactors.includes(0))this.resizer.disconnect();else try{for(var n=s(this.elements),r=n.next();!r.done;r=n.next()){r.value.resize(this)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.append=function(e){var t,n;this.elements.push(e);try{for(var r=s(e.getElements()),o=r.next();!o.done;o=r.next()){var i=o.value;this.svg.appendChild(i)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getElements=function(){return this.elements},e.prototype.getLabels=function(){return this.getElements().map((function(e){return e.getLabel()}))},e.prototype.remove=function(e){var t=this;this.elements.find((function(n,r){var o,i;if(n.getAnchorElement()===e.getAnchorElement()){try{for(var u=s(e.getElements()),a=u.next();!a.done;a=u.next()){a.value.remove()}}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return t.elements.splice(r,1),!0}}))},e.prototype.setMaxOcclusions=function(e){this.maxOcclusions=e},e.prototype.getNextNum=function(e){var t=e.altKey?0:1,n=Math.max(1,function(e){var t,n,r=0;try{for(var o=s(e),i=o.next();!i.done;i=o.next()){var u=i.value.match(te);if(u){var a=Number(u[2]);Number.isNaN(a)||(r=Math.max(r,a))}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(this.getLabels())+t);return n>this.maxOcclusions?0:n},e.prototype.cleanup=function(){var e=this.container.removeChild(this.image);this.container.replaceWith(e)},e}(),nr=function(){function e(e,t,n,r,o){this.scaleFactorX=1,this.scaleFactorY=1,this.container=e,this.rect=t,this.label=n,this.setScaleFactors(r,o)}return e.make=function(t){var n=document.createElementNS(er,"svg"),r=document.createElementNS(er,"rect"),o=document.createElementNS(er,"text");n.appendChild(r),n.appendChild(o),n.classList.add("closet-rect"),n.classList.add("closet-shape"),n.tabIndex=-1;var i=a(t?t.scaleFactors:[1,1],2);return new e(n,r,o,i[0],i[1])},e.wrap=function(t,n){var r=a(n?n.scaleFactors:[1,1],2),o=r[0],i=r[1];return new e(t.parentElement,t,t.nextSibling,o,i)},e.prototype.remove=function(){this.container.remove()},e.prototype.getElements=function(){return[this.container]},e.prototype.getAnchorElement=function(){return this.rect},e.prototype.getLabel=function(){return this.labelText},e.prototype.setScaleFactors=function(e,t){this.scaleFactorX=e,this.scaleFactorY=t},e.prototype.readjust=function(e){var t=e?e.scaleFactors:[1,1],n=this.scaleFactorX,r=this.scaleFactorY;return this.setScaleFactors(t[0],t[1]),[n,r]},e.prototype.resize=function(e){var t=this.pos;this.readjust(e),this.pos=t},e.prototype.toDefinition=function(){return["rect",void 0,this.labelText,this.x,this.y,this.width,this.height,{}]},e.prototype.toText=function(e){return""+e.open+this.labelText+e.sep+this.x.toFixed()+","+this.y.toFixed()+","+this.width.toFixed()+","+this.height.toFixed()+e.close},e.prototype.fontSizeUpdate=function(){var e=a(this.readjust(),2),t=e[0],n=e[1],r=Math.max(.1,Math.min(32,.4*((this.width+this.height)/2-2*this.strokeWidth)));this.fontSize=r,this.setScaleFactors(t,n)},Object.defineProperty(e.prototype,"pos",{get:function(){return[this.x,this.y,this.width,this.height]},set:function(e){var t=a(e,4),n=t[0],r=t[1],o=t[2],i=t[3];this.width=o,this.height=i,this.x=n,this.y=r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaled",{get:function(){return[Number(this.rect.getAttributeNS(null,"x")),Number(this.rect.getAttributeNS(null,"y")),Number(this.rect.getAttributeNS(null,"width")),Number(this.rect.getAttributeNS(null,"height"))]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return Number(this.rect.getAttributeNS(null,"x"))/this.scaleFactorX},set:function(e){var t=e*this.scaleFactorX,n=(e+this.width/2)*this.scaleFactorX;this.rect.setAttributeNS(null,"x",String(t)),this.label.setAttributeNS(null,"x",String(n))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return Number(this.rect.getAttributeNS(null,"y"))/this.scaleFactorY},set:function(e){var t=e*this.scaleFactorY,n=(e+this.height/2)*this.scaleFactorY;this.rect.setAttributeNS(null,"y",String(t)),this.label.setAttributeNS(null,"y",String(n))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Number(this.rect.getAttributeNS(null,"width"))/this.scaleFactorX},set:function(e){var t=String(Math.max(10,e)*this.scaleFactorX);this.rect.setAttributeNS(null,"width",t),this.label.setAttributeNS(null,"width",t),this.fontSizeUpdate()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Number(this.rect.getAttributeNS(null,"height"))/this.scaleFactorY},set:function(e){var t=String(Math.max(10,e)*this.scaleFactorY);this.rect.setAttributeNS(null,"height",t),this.label.setAttributeNS(null,"height",t),this.fontSizeUpdate()},enumerable:!1,configurable:!0}),e.prototype.props=function(e){for(var t in e){var n=t;this.prop(n,e[n])}},e.prototype.prop=function(e,t){this[e]=t},Object.defineProperty(e.prototype,"containerClasses",{get:function(){return Array.from(this.container.className).join(" ")},set:function(e){var t=this;e.split(" ").forEach((function(e){return t.container.classList.add(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return Number(this.rect.getAttributeNS(null,"rx"))},set:function(e){this.rect.setAttributeNS(null,"rx",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return Number(this.rect.getAttributeNS(null,"ry"))},set:function(e){this.rect.setAttributeNS(null,"ry",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){var e;return null!==(e=this.rect.getAttributeNS(null,"fill"))&&void 0!==e?e:""},set:function(e){this.rect.setAttributeNS(null,"fill",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillOpacity",{get:function(){return Number(this.rect.getAttributeNS(null,"fill-opacity"))},set:function(e){this.rect.setAttributeNS(null,"fill-opacity",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stroke",{get:function(){var e;return null!==(e=this.rect.getAttributeNS(null,"stroke"))&&void 0!==e?e:""},set:function(e){this.rect.setAttributeNS(null,"stroke",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeOpacity",{get:function(){return Number(this.rect.getAttributeNS(null,"stroke-opacity"))},set:function(e){this.rect.setAttributeNS(null,"stroke-opacity",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeWidth",{get:function(){return Number(this.rect.getAttributeNS(null,"stroke-width"))},set:function(e){this.rect.setAttributeNS(null,"stroke-width",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classes",{get:function(){return Array.from(this.rect.classList).join(" ")},set:function(e){var t=this;e.split(" ").forEach((function(e){return t.rect.classList.add(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelText",{get:function(){return this.label.innerHTML},set:function(e){this.label.innerHTML=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return Number(this.label.getAttributeNS(null,"font-size"))},set:function(e){this.label.setAttributeNS(null,"font-size",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelClasses",{get:function(){return Array.from(this.label.classList).join(" ")},set:function(e){var t=this;e.split(" ").forEach((function(e){return t.label.classList.add(e)}))},enumerable:!1,configurable:!0}),e}(),rr=function(e,t,n,r,o,i,u,s){return function(c){var l=a(e(Vn(c)),2),p=l[0],f=l[1];n&&p<u?(t.x=p,t.width=u-p):r&&(t.x=u,t.width=p-u),o&&f<s?(t.y=f,t.height=s-f):i&&(t.y=s,t.height=f-s)}},or=function(e,t,n,r,o,i,u,s,c){return function(l,p,f){var h=a(l.scaled,4),d=h[0],m=h[1],v=d+h[2]-p,y=f-m,g=m+h[3]-f;return p-d<=5?y<=5?e(l):g<=5?t(l):n(l):v<=5?y<=5?r(l):g<=5?o(l):i(l):y<=5?u(l):g<=5?s(l):c(l)}},ir=or((function(e){return[!0,!1,!0,!1,e.x+e.width,e.y+e.height]}),(function(e){return[!0,!1,!1,!0,e.x+e.width,e.y]}),(function(e){return[!0,!1,!1,!1,e.x+e.width,0]}),(function(e){return[!1,!0,!0,!1,e.x,e.y+e.height]}),(function(e){return[!1,!0,!1,!0,e.x,e.y]}),(function(e){return[!1,!0,!1,!1,e.x,0]}),(function(e){return[!1,!1,!0,!1,0,e.y+e.height]}),(function(e){return[!1,!1,!1,!0,0,e.y]}),(function(){return[!1,!1,!1,!1,0,0]})),ur=or((function(){return"nwse-resize"}),(function(){return"nesw-resize"}),(function(){return"ew-resize"}),(function(){return"nesw-resize"}),(function(){return"nwse-resize"}),(function(){return"ew-resize"}),(function(){return"ns-resize"}),(function(){return"ns-resize"}),(function(){return"move"})),sr=function(e){return function(t){var n=a(t,2),r=n[0],o=n[1],i=function(e){return function(t){var n=a(t,2),r=n[0],o=n[1],i=e.getPropertyValue("zoom"),u=Number(i);return Number.isNaN(u)||u<=0?[r,o]:[r/u,o/u]}}(e);return i([r,o])}},ar=function(e){var t=document.createElement("li"),n=document.createElement("a");return e.html?n.innerHTML=e.label:n.innerText=e.label,n.id=e.itemId,n.classList.add("context-menu-item"),e.clickEvent&&n.addEventListener("click",e.clickEvent),t.appendChild(n),e.sub&&e.sub.length>0&&t.appendChild(cr(e.sub)),t},cr=function(e){var t,n,r=document.createElement("ul"),o=e.map(ar);try{for(var i=s(o),u=i.next();!u.done;u=i.next()){var a=u.value;r.appendChild(a)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},lr=function(e){return function(){e.classList.remove("context-menu--active")}},pr=function(e,t){var n=lr(e);t.addEventListener("contextmenu",(function(t){t.preventDefault(),t.stopPropagation(),document.querySelectorAll(".context-menu--active").forEach((function(e){return e.classList.remove("context-menu--active")})),e.classList.add("context-menu--active"),window.addEventListener("click",n,{once:!0}),function(e,t,n){e.style.left=t+"px",e.style.top=n+"px"}(e,t.pageX,t.pageY)}))},fr=function(e,t){var n,r,o,i=(n=e,r=t,(o=document.createElement("nav")).classList.add("context-menu"),o.id=n,o.appendChild(cr(r)),o);return document.body.insertAdjacentElement("beforeend",i),function(e){e.addEventListener("click",(function(e){e.stopPropagation()})),e.querySelectorAll("li").forEach((function(t){t.addEventListener("mouseenter",(function(){t.classList.add("context-menu--hover")})),t.addEventListener("mouseleave",(function(){t.classList.remove("context-menu--hover")})),t.addEventListener("click",(function(){lr(e)()}))}))}(i),i},hr=function(e,t){var n=t.template,r=t.cache,o=Un(n),i=r.get(e.keyword,[]),u=o[0];u&&Qn('img[src="'+u[0]+'"]',u[1],(function(e){var t,r;n.appendStyle(e.target,"occlusionSvgCss",Zn);var o=tr.wrapImage(e.target);try{for(var u=s(i),c=u.next();!c.done;c=u.next()){var l=a(c.value,8),p=l[1],f=l[3],h=l[4],d=l[5],m=l[6],v=l[7];if(p){var y=nr.make(o);for(var g in y.pos=[f,h,d,m],v){var b=g;y.prop(b,v[b])}o.append(y)}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}}))},dr=function(e,t){void 0===t&&(t={});var n={};return e.map((function(e){return e.split("=")})).forEach((function(e){var t=a(e,2),r=t[0],o=t[1];return n[r]=o})),Object.assign(n,t)},mr=function(e){return function(t,n){var r=a(t.values),o=r[0],i=void 0===o?0:o,u=r[1],s=void 0===u?0:u,c=r[2],l=void 0===c?50:c,p=r[3],f=void 0===p?l:p,h=r.slice(4),d="function"==typeof e?e(t,n):e;return n.cache.over("occlusionRenderRect",(function(e){return e.push(["rect",!0,t.fullKey,Number(i),Number(s),Number(l),Number(f),dr(h,d)])}),[]),n.aftermath.registerIfNotExists("occlusionRenderRect",hr),{ready:!0}}},vr={classes:"closet-rect__rect",labelClasses:"closet-rect__label"},yr={classes:"closet-rect__ellipsis",labelClasses:"closet-rect__ellipsis"},gr=an((function(e,t){return function(n){void 0===n&&(n={});var r=n.tagname,o=void 0===r?"rect":r,u=n.front,s=void 0===u?mr:u,a=n.back,c=void 0===a?mr:a,l=n.optics,p=void 0===l?[I({sep:","})]:l,f=n.flashcardTemplate,h=void 0===f?sn():f,d=n.frontProperties,m=void 0===d?i(i({},vr),{containerClasses:"is-active is-front"}):d,v=n.backProperties,y=void 0===v?i(i({},vr),{containerClasses:"is-active is-back"}):v,g=n.ellipseProperties,b=void 0===g?i(i({},yr),{containerClasses:"is-inactive"}):g,x=n.contextProperties,A=void 0===x?i(i({},vr),{containerClasses:"is-inactive"}):x,w={optics:p};return h(e,t)(o,s(m),c(y),mr(b),mr(A),w)}})),br=function(e,t){var n=nr.wrap(t.target);if(t.shiftKey)e.remove(n);else{var r=sr(window.getComputedStyle(e.image)),o=a(r(Vn(t)),2),i=o[0],u=o[1],s=ir(n,i,u),l=s.includes(!0)?rr.apply(void 0,c([r,n],s)):function(e,t,n,r,o,i){return function(u){var s=a(e(Vn(u)),2),c=s[0],l=s[1],p=n+(c-o),f=r+(l-i);t.x=p,t.y=f}}(r,n,n.x,n.y,i,u);e.svg.addEventListener("mousemove",l),e.svg.addEventListener("mouseup",(function(t){t.preventDefault(),e.svg.removeEventListener("mousemove",l)}),{once:!0})}},xr=function(e,t){var n=sr(window.getComputedStyle(e.image));t.rect.addEventListener("mousemove",function(e,t){return function(n){if(n.shiftKey)t.rect.style.cursor="no-drop";else{var r=a(e(Vn(n)),2),o=r[0],i=r[1],u=ur(t,o,i);t.rect.style.cursor=u}}}(n,t));var r=fr("occlusion-shape-menu",[{label:"Change Label",itemId:"change-label",clickEvent:function(){var e=prompt("Specify the new label",t.labelText);"string"==typeof e&&(t.labelText=e)}},{label:"Close Menu",itemId:"close-occlusion-menu"}]);pr(r,t.rect),e.append(t)},Ar=function(e,t,n,r,o){var i=nr.make();return i.pos=[e,t,n,r],i.labelText=o,i.classes="closet-rect__rect",i.labelClasses="closet-rect__label",i},wr=function(e,t){var n=sr(window.getComputedStyle(e.image)),r=a(n(Vn(t)),2),o=r[0],i=r[1],u=e.getNextNum(t),s=Ar(o,i,0,0,"rect"+u);xr(e,s);var c=rr(n,s,!0,!0,!0,!0,o,i);e.svg.addEventListener("mousemove",c),e.svg.addEventListener("mouseup",(function(){e.svg.removeEventListener("mousemove",c),s.readjust(e)}))},kr=function(e,t){e.svg.addEventListener("mousedown",(function(t){0===t.button&&function(e,t){t.preventDefault(),("svg"!==t.target.nodeName?br:wr)(e,t)}(e,t)})),pr(t,e.svg)},Er=function(e,t){return function(e){navigator.clipboard.writeText(e.map((function(e){return e.toText(t.template.parser.delimiters)})).join("\n")).catch((function(){return console.log("Window needs active focus for copying to clipboard")}))}},Fr=function(){return function(e,t){return t.cleanup()}},Sr={occlusionEditor:function(e){return void 0===e&&(e={}),function(t){var n="makeOcclusions",r=new EventTarget,o=e.tagname,i=void 0===o?n:o,u=e.maxOcclusions,l=void 0===u?500:u,p=e.acceptHandler,f=void 0===p?Er:p,h=e.rejectHandler,d=void 0===h?Fr:h,m=e.setupOcclusionMenu,v=void 0===m?B:m,y=e.existingShapesFilter,g=void 0===y?function(){return B}:y,b=e.shapeKeywords,x=void 0===b?["occlusionRenderRect"]:b;return t.register(i,(function(e,t){var o=t.template,i=Un(o);return t.aftermath.registerIfNotExists(n,(function(e,t){var n,o,u,p,h=[];try{for(var m=s(x),y=m.next();!y.done;y=m.next()){var b=y.value,A=t.cache.get(b,[]);h.push.apply(h,c(A)),t.aftermath.block(b)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}var w=function(n){var o=n.target,i=t.template;i.appendDocumentStyle("occlusionMakerCss","\n:root {\n  --cm-niceblue: #3f8cf1;\n  --cm-nicegray: #444;\n  --cm-backgray: #ececec;\n  --cm-boxgray: #cfcfcf;\n}\n\nnav.context-menu {\n  position: absolute;\n  z-index: 9999;\n  display: none;\n}\n\nnav.context-menu--active {\n  display: block;\n}\n\n/******************** UL */\n\nnav.context-menu ul {\n  position: absolute;\n\n  padding: 0.2rem 0;\n  width: 10rem;\n\n  white-space: nowrap;\n  list-style: none;\n\n  background-color: var(--cm-backgray);\n  border: solid 1px var(--cm-boxgray);\n  box-shadow: 1px 1px 2px var(--cm-boxgray);\n}\n\n/******************** LI */\n\nnav.context-menu li {\n  margin-bottom: 2px;\n}\n\nnav.context-menu li.context-menu--hover {\n  background-color: var(--cm-niceblue);\n}\n\nnav.context-menu li:last-child {\n  margin-bottom: 0;\n}\n\nnav.context-menu li ul {\n  display: none;\n  margin-left: 2rem;\n}\n\nnav.context-menu li.context-menu--hover ul {\n  display: block;\n}\n\nnav.context-menu li li ul {\n  display: none;\n  margin-left: 4rem;\n}\n\nnav.context-menu li li.context-menu--hover ul {\n  display: block;\n}\n\n/******************** A */\n\nnav.context-menu a {\n  display: block;\n  padding: 0.3rem 1rem;\n  user-select: none;\n\n  color: var(--cm-nicegray);\n}\n\nnav.context-menu li.context-menu--hover a {\n  color: white;\n}\n"),i.appendStyle(o,"occlusionMakerCss","\n.closet-occlusion-container {\n  outline: 3px dotted hotpink;\n  outline-offset: -3px;\n}"),i.appendStyle(o,"occlusionSvgCss",Zn);var u=tr.wrapImage(o);u.setMaxOcclusions(l),g(e,t)(h,u).forEach((function(e){return function(e,t){var n,r=null,o=null,i=null,u=null,s=null,c=null,l=a(t),p=l[0],f=l.slice(2);"rect"===p&&(r=(n=a(f,5))[0],o=n[1],i=n[2],u=n[3],s=n[4],c=Ar(o,i,u,s,r),xr(e,c))}(u,e)}));r.addEventListener("accept",(function(){f(e,t)(u.getElements(),u)})),r.addEventListener("reject",(function(){d(e,t)(u.getElements(),u)}));var s=function(e,t){var n=t([{label:"Accept occlusions",itemId:"occlusion-accept",clickEvent:function(t){t.preventDefault(),e.dispatchEvent(new Event("accept"))}},{label:"Close Menu",itemId:"close-occlusion-menu"}]);return fr("occlusion-menu",n)}(r,v);kr(u,s)};try{for(var k=s(i),E=k.next();!E.done;E=k.next()){var F=a(E.value,2),S=F[0],C=F[1];Qn('img[src="'+S+'"]',C,w)}}catch(e){u={error:e}}finally{try{E&&!E.done&&(p=k.return)&&p.call(k)}finally{if(u)throw u.error}}}),{priority:100}),{ready:!0}})),r}},rect:gr},Cr=Object.freeze({__proto__:null,recipes:Sr}),Br=Object.freeze({__proto__:null,wrap:Xt,deferred:Vt,aftermath:Qt,sum:Zt,sumFour:en,product:function(e,t,n,r){void 0===n&&(n=function(){return function(){return{ready:!0}}});var o=void 0===r?{wrapId:"product",getTagnames:Yt,setTagnames:Wt}:r,i=o.wrapId,u=o.setTagnames;return function(r){var o=void 0===r?{}:r,s=o.tagname,a=void 0===s?"prod":s,c=o.optionsFirst,l=void 0===c?{}:c,p=o.optionsSecond,f=void 0===p?{}:p;return function(r){var o=a+":"+i+":fst",s=a+":"+i+":snd";e(u(l,[o]))(r),t(u(f,[s]))(r);r.register(a,(function(e,t){return n(t.filters.getOrDefault(o)(e,t),t.filters.getOrDefault(s)(e,t))(e,t)}),r.getOptions(o))}}},collection:tn}),Nr=Object.freeze({__proto__:null,template:Qe,recipes:Mt,flashcard:Rn,browser:Cr,Stylizer:yt,wrappers:Br,sequencers:Et,sortInStrategies:St,patterns:Wn,versionInfo:e,prereleaseInfo:t,version:n,FilterManager:C});export{Nr as closet};
